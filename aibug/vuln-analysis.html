<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæ¼æ´åˆ†æ - XHSecTeam</title>
    <link rel="stylesheet" href="../static/css/common.css">
    <script src="../static/css/common.js"></script>
    <script src="../static/js/layout.js"></script>
    <style>
        /* AIæ¼æ´åˆ†æé¡µé¢ç‰¹æœ‰æ ·å¼ */
        
        /* é¡µé¢æ ‡é¢˜åŒºåŸŸ */
        .page-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.78);
            border: 1px solid rgba(148, 163, 184, 0.22);
            border-radius: 16px;
            box-shadow: 0 14px 40px rgba(15, 23, 42, 0.08);
        }
        .page-header-left {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .page-title {
            font-size: 20px;
            font-weight: 700;
            color: #0f172a;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .page-title-badge {
            font-size: 10px;
            padding: 4px 10px;
            border-radius: 999px;
            background: linear-gradient(135deg, #3b82f6, #06b6d4);
            color: #fff;
            font-weight: 700;
            letter-spacing: 0.08em;
        }
        .page-subtitle {
            font-size: 13px;
            color: var(--text-secondary);
        }
        .page-header-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .header-btn {
            height: 36px;
            padding: 0 16px;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.26);
            background: rgba(248, 250, 252, 0.9);
            color: #334155;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }
        .header-btn:hover {
            border-color: var(--accent-green);
            color: var(--accent-green);
        }
        .header-btn.primary {
            background: var(--accent-green);
            border-color: var(--accent-green);
            color: #fff;
        }
        .header-btn.primary:hover {
            background: #059669;
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        .stat-card {
            background: rgba(255, 255, 255, 0.78);
            border: 1px solid rgba(148, 163, 184, 0.22);
            border-radius: 16px;
            padding: 18px 20px;
            box-shadow: 0 10px 30px rgba(15, 23, 42, 0.06);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 18px 44px rgba(15, 23, 42, 0.10);
        }
        .stat-card-value {
            font-size: 28px;
            font-weight: 800;
            color: #0f172a;
            margin-bottom: 4px;
        }
        .stat-card-label {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        .stat-card.high .stat-card-value { color: #ef4444; }
        .stat-card.medium .stat-card-value { color: #f59e0b; }
        .stat-card.low .stat-card-value { color: #3b82f6; }
        .stat-card.info .stat-card-value { color: #94a3b8; }
        @media (max-width: 1100px) { .stats-grid { grid-template-columns: repeat(3, 1fr); } }
        @media (max-width: 640px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } }

        /* ç½‘ç«™æ¼æ´å¡ç‰‡ */
        .site-card {
            background: rgba(255, 255, 255, 0.78);
            border: 1px solid rgba(148, 163, 184, 0.22);
            border-radius: 16px;
            margin-bottom: 20px;
            box-shadow: 0 14px 40px rgba(15, 23, 42, 0.08);
            overflow: hidden;
        }
        .site-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            background: linear-gradient(180deg, rgba(248, 250, 252, 0.92), rgba(255, 255, 255, 0.65));
            border-bottom: 1px solid rgba(148, 163, 184, 0.18);
            cursor: pointer;
            transition: background 0.2s;
        }
        .site-header:hover {
            background: rgba(241, 245, 249, 0.9);
        }
        .site-header-left {
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 0;
            flex: 1;
        }
        .site-expand-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-tertiary);
            transition: transform 0.2s;
        }
        .site-expand-icon svg {
            width: 16px;
            height: 16px;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
        }
        .site-card.expanded .site-expand-icon {
            transform: rotate(90deg);
        }

        .site-info {
            min-width: 0;
            flex: 1;
        }
        .site-url {
            font-size: 14px;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .site-url a {
            color: inherit;
            text-decoration: none;
        }
        .site-url a:hover {
            color: var(--accent-green);
        }
        .site-meta {
            font-size: 11px;
            color: var(--text-tertiary);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .site-header-right {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-shrink: 0;
        }
        .site-vuln-count {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 999px;
            font-size: 11px;
            font-weight: 700;
        }
        .site-vuln-count.high {
            background: rgba(239, 68, 68, 0.12);
            color: #dc2626;
        }
        .site-vuln-count.medium {
            background: rgba(245, 158, 11, 0.12);
            color: #d97706;
        }
        .site-vuln-count.low {
            background: rgba(59, 130, 246, 0.12);
            color: #2563eb;
        }
        .site-vuln-count .count-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }
        .site-vuln-count.high .count-dot { background: #ef4444; }
        .site-vuln-count.medium .count-dot { background: #f59e0b; }
        .site-vuln-count.low .count-dot { background: #3b82f6; }

        /* ç½‘ç«™å†…å®¹ */
        .site-body {
            display: none;
            padding: 0;
        }
        .site-card.expanded .site-body {
            display: block;
        }

        /* å­åŸŸå/æ—ç«™åŒºåŸŸ */
        .subdomain-section {
            border-top: 1px solid rgba(148, 163, 184, 0.15);
        }
        .subdomain-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 20px;
            background: rgba(248, 250, 252, 0.6);
            cursor: pointer;
        }
        .subdomain-header:hover {
            background: rgba(241, 245, 249, 0.8);
        }
        .subdomain-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .subdomain-badge {
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 999px;
            background: rgba(59, 130, 246, 0.12);
            color: #2563eb;
            font-weight: 700;
        }
        .subdomain-list {
            display: none;
            padding: 0;
        }
        .subdomain-section.expanded .subdomain-list {
            display: block;
        }

        /* å­åŸŸåé¡¹ */
        .subdomain-item {
            border-top: 1px solid rgba(226, 232, 240, 0.6);
        }
        .subdomain-item-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 20px 10px 40px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .subdomain-item-header:hover {
            background: rgba(248, 250, 252, 0.8);
        }
        .subdomain-item-left {
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 0;
            flex: 1;
        }
        .subdomain-item-icon {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            background: rgba(100, 116, 139, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        .subdomain-item-icon svg {
            width: 12px;
            height: 12px;
            stroke: var(--text-tertiary);
            fill: none;
            stroke-width: 2;
        }
        .subdomain-item-url {
            font-size: 12px;
            font-weight: 600;
            color: #334155;
        }
        .subdomain-item-url a {
            color: inherit;
            text-decoration: none;
        }
        .subdomain-item-url a:hover {
            color: var(--accent-green);
        }
        .subdomain-item-type {
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 999px;
            background: rgba(148, 163, 184, 0.15);
            color: var(--text-tertiary);
            font-weight: 600;
        }
        .subdomain-item-type.subdomain {
            background: rgba(6, 182, 212, 0.12);
            color: #0891b2;
        }
        .subdomain-item-type.sidesite {
            background: rgba(168, 85, 247, 0.12);
            color: #9333ea;
        }

        /* æ¼æ´åˆ—è¡¨ */
        .vuln-list {
            padding: 16px 20px;
        }
        .vuln-item {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(148, 163, 184, 0.18);
            border-radius: 14px;
            padding: 16px 18px;
            margin-bottom: 12px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .vuln-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 24px rgba(15, 23, 42, 0.08);
        }
        .vuln-item:last-child {
            margin-bottom: 0;
        }
        .vuln-item-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .vuln-item-title {
            font-size: 14px;
            font-weight: 700;
            color: #0f172a;
        }
        .vuln-item-level {
            font-size: 10px;
            padding: 4px 12px;
            border-radius: 999px;
            font-weight: 800;
            letter-spacing: 0.06em;
            text-transform: uppercase;
        }
        .vuln-item-level.high {
            background: rgba(239, 68, 68, 0.12);
            color: #dc2626;
        }
        .vuln-item-level.medium {
            background: rgba(245, 158, 11, 0.12);
            color: #d97706;
        }
        .vuln-item-level.low {
            background: rgba(59, 130, 246, 0.12);
            color: #2563eb;
        }
        .vuln-item-level.info {
            background: rgba(148, 163, 184, 0.15);
            color: #64748b;
        }
        
        /* æ¼æ´é¡¹æ“ä½œæŒ‰é’®å®¹å™¨ */
        .vuln-item-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* AIåˆ†ææŒ‰é’® */
        .ai-analyze-btn {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            font-size: 10px;
            font-weight: 600;
            color: #64748b;
            background: rgba(248, 250, 252, 0.9);
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 999px;
            cursor: pointer;
            transition: all 0.2s;
            backdrop-filter: blur(10px);
        }
        
        .ai-analyze-btn:hover {
            background: rgba(241, 245, 249, 0.95);
            border-color: #10b981;
            color: #059669;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .ai-analyze-btn svg {
            width: 10px;
            height: 10px;
        }
        
        .vuln-item-desc {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 12px;
        }
        .vuln-item-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 12px;
        }
        .vuln-item-meta span {
            font-size: 11px;
            padding: 4px 10px;
            border-radius: 999px;
            background: rgba(248, 250, 252, 0.9);
            border: 1px solid rgba(148, 163, 184, 0.18);
            color: #334155;
            font-weight: 600;
        }
        .vuln-item-code {
            position: relative;
            background: #f8fafc;
            border: 1px solid rgba(148, 163, 184, 0.18);
            border-radius: 10px;
            padding: 14px;
            font-family: 'SF Mono', Monaco, Consolas, monospace;
            font-size: 12px;
            color: #334155;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        .vuln-item-code strong {
            color: #0f172a;
        }

        /* AIåˆ†æç»“æœ */
        .ai-analysis {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.08), rgba(6, 182, 212, 0.08));
            border: 1px solid rgba(16, 185, 129, 0.22);
            border-radius: 12px;
            padding: 14px 16px;
            margin-top: 12px;
        }
        .ai-analysis-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }
        .ai-analysis-icon {
            width: 20px;
            height: 20px;
            border-radius: 6px;
            background: linear-gradient(135deg, #10b981, #06b6d4);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 10px;
            font-weight: 700;
        }
        .ai-analysis-title {
            font-size: 12px;
            font-weight: 700;
            color: #059669;
        }
        .ai-analysis-content {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-tertiary);
        }
        .empty-state-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 16px;
            border-radius: 16px;
            background: rgba(148, 163, 184, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .empty-state-icon svg {
            width: 32px;
            height: 32px;
            stroke: var(--text-tertiary);
            fill: none;
            stroke-width: 1.5;
        }
        .empty-state-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        .empty-state-desc {
            font-size: 13px;
        }

        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }
            .page-header-right {
                width: 100%;
                justify-content: flex-end;
            }
            .site-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
            .site-header-right {
                width: 100%;
                justify-content: flex-start;
            }
        }
        
        /* ä»£ç å—å¤åˆ¶æŒ‰é’® */
        .vuln-item-code {
            position: relative;
        }
        
        .code-copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            padding: 5px 10px;
            font-size: 11px;
            font-weight: 600;
            color: #64748b;
            background: rgba(248, 250, 252, 0.9);
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            backdrop-filter: blur(10px);
            z-index: 1;
        }
        
        .code-copy-btn:hover {
            background: rgba(241, 245, 249, 0.95);
            border-color: var(--accent-green);
            color: var(--accent-green);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .code-copy-btn.copied {
            background: var(--accent-green);
            border-color: var(--accent-green);
            color: white;
        }
        
        /* å¯¼èˆªæ æœç´¢æ¡† */
        .nav-search {
            display: flex;
            align-items: center;
            height: 32px;
            background: rgba(248, 250, 252, 0.9);
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 999px;
            padding: 2px;
            margin-left: 12px;
            transition: all 0.2s;
            backdrop-filter: blur(10px);
        }
        
        .nav-search:hover {
            border-color: var(--accent-green);
            box-shadow: 0 0 0 2px rgba(0, 214, 143, 0.2);
        }
        
        .nav-search-input {
            height: 26px;
            padding: 0 10px;
            padding-right: 4px;
            border: none;
            background: transparent;
            color: #334155;
            font-size: 12px;
            outline: none;
            width: 160px;
        }
        
        .nav-search-input::placeholder {
            color: #94a3b8;
        }
        
        .nav-search-btn {
            width: 26px;
            height: 26px;
            border: none;
            background: transparent;
            border-radius: 50%;
            color: #94a3b8;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .nav-search-btn:hover {
            background: rgba(148, 163, 184, 0.2);
            color: var(--accent-green);
        }
        
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ å ä½ç¬¦ï¼Œç”± layout.js åŠ è½½ -->
    <nav class="navbar" id="navbar"></nav>

    <div class="main-layout">
        <main class="content">
            <!-- æµ®åŠ¨å¯¼èˆªå ä½ç¬¦ï¼Œç”± layout.js åŠ è½½ -->
            <div class="floating-nav" id="floatingNav"></div>

            <!-- é¡µé¢å¤´éƒ¨ -->
            <div class="page-header">
                <div class="page-header-left">
                    <div class="page-title">
                        AI æ¼æ´åˆ†ææŠ¥å‘Š
                        <span class="page-title-badge">INTELLIGENCE</span>
                    </div>
                    <div class="page-subtitle">æ™ºèƒ½åˆ†ææ‰«æç»“æœï¼Œç”Ÿæˆè¯¦ç»†çš„æ¼æ´æŠ¥å‘Šä¸ä¿®å¤å»ºè®®</div>
                </div>
                <div class="page-header-right">
                    <button class="header-btn" onclick="refreshAnalysis()">
                         åˆ·æ–°åˆ†æ
                    </button>
                    <button class="header-btn primary" onclick="startAiAnalysis()">
                         AI æ·±åº¦åˆ†æ
                    </button>
                </div>
            </div>

            <!-- ç»Ÿè®¡å¡ç‰‡ -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-value" id="totalSites">12</div>
                    <div class="stat-card-label">æ‰«æç«™ç‚¹</div>
                </div>
                <div class="stat-card high">
                    <div class="stat-card-value" id="highVulns">8</div>
                    <div class="stat-card-label">é«˜å±æ¼æ´</div>
                </div>
                <div class="stat-card medium">
                    <div class="stat-card-value" id="mediumVulns">15</div>
                    <div class="stat-card-label">ä¸­å±æ¼æ´</div>
                </div>
                <div class="stat-card low">
                    <div class="stat-card-value" id="lowVulns">6</div>
                    <div class="stat-card-label">ä½å±æ¼æ´</div>
                </div>
                <div class="stat-card info">
                    <div class="stat-card-value" id="infoVulns">23</div>
                    <div class="stat-card-label">ä¿¡æ¯æ³„éœ²</div>
                </div>
            </div>

            <!-- ç½‘ç«™æ¼æ´åˆ—è¡¨ -->
            <div id="siteList">
                <!-- ç½‘ç«™1 -->
                <div class="site-card expanded" id="site-1">
                    <div class="site-header" onclick="toggleSite('site-1')">
                        <div class="site-header-left">
                            <div class="site-expand-icon">
                                <svg viewBox="0 0 24 24"><path d="M9 18l6-6-6-6"/></svg>
                            </div>
                            <div class="site-info">
                                <div class="site-url"><a href="https://movie.example1.com" target="_blank">movie.example1.com</a></div>
                                <div class="site-meta">
                                    <span>IP: 192.168.1.100</span>
                                    <span>è‹¹æœCMS V10</span>
                                    <span>æœ€åæ‰«æ: 2024-01-15 14:30</span>
                                </div>
                            </div>
                        </div>
                        <div class="site-header-right">
                            <div class="site-vuln-count high"><span class="count-dot"></span> 3 é«˜å±</div>
                            <div class="site-vuln-count medium"><span class="count-dot"></span> 2 ä¸­å±</div>
                        </div>
                    </div>
                    <div class="site-body">
                        <!-- ä¸»ç«™æ¼æ´ -->
                        <div class="vuln-list">
                            <div class="vuln-item">
                                <div class="vuln-item-header">
                                    <div class="vuln-item-title">SQLæ³¨å…¥æ¼æ´</div>
                                    <div class="vuln-item-actions">
                                        <div class="vuln-item-level high">é«˜å±</div>
                                        <button class="ai-analyze-btn" onclick="analyzeVulnerability('SQLæ³¨å…¥æ¼æ´', this)">
                                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 10 10 0 0 0-10-10z"/>
                                                <path d="M8.5 14.5 12 11l3.5 3.5"/>
                                            </svg>
                                            AIåˆ†æ
                                        </button>
                                    </div>
                                </div>
                                <div class="vuln-item-desc">
                                    è‹¹æœCMS v10 æœç´¢åŠŸèƒ½å­˜åœ¨SQLæ³¨å…¥æ¼æ´ï¼Œæœªå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œè¿‡æ»¤ï¼Œæ”»å‡»è€…å¯ç›´æ¥è·å–æ•°æ®åº“ç®¡ç†å‘˜è´¦å·å¯†ç ã€ç”¨æˆ·æ•°æ®ç­‰æ•æ„Ÿä¿¡æ¯ã€‚
                                </div>
                                <div class="vuln-item-meta">
                                    <span>CVE-2023-27890</span>
                                    <span>å½±å“ç‰ˆæœ¬: v10.x</span>
                                    <span>CVSS: 9.8</span>
                                    <span>è·¯å¾„: /index.php?m=vod-search</span>
                                </div>
                                <div class="vuln-item-code"><strong>åˆ©ç”¨æ–¹æ³•:</strong>
curl "https://movie.example1.com/index.php?m=vod-search&wd=1'%20AND%20(SELECT%20SLEEP(5))--+"

# è¯»å–ç®¡ç†å‘˜è´¦å·
curl "https://movie.example1.com/index.php?m=vod-search&wd=1'%20UNION%20SELECT%201,user_name,user_pwd,4,5%20FROM%20mac_admin--+"</div>
                                <div class="ai-analysis">
                                    <div class="ai-analysis-header">
                                        <div class="ai-analysis-icon">AI</div>
                                        <div class="ai-analysis-title">AI åˆ†æå»ºè®®</div>
                                    </div>
                                    <div class="ai-analysis-content">
                                        è¯¥æ¼æ´ä¸ºé«˜å±SQLæ³¨å…¥ï¼Œå»ºè®®ç«‹å³ä¿®å¤ã€‚ä¿®å¤æ–¹æ¡ˆï¼š1) å‡çº§è‡³æœ€æ–°ç‰ˆæœ¬ v10.8ï¼›2) å¯¹æœç´¢å‚æ•°è¿›è¡Œä¸¥æ ¼è¿‡æ»¤å’Œé¢„ç¼–è¯‘å¤„ç†ï¼›3) å¯ç”¨WAFè§„åˆ™æ‹¦æˆªSQLæ³¨å…¥æ”»å‡»ã€‚
                                    </div>
                                </div>
                            </div>
                            <div class="vuln-item">
                                <div class="vuln-item-header">
                                    <div class="vuln-item-title">è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)</div>
                                    <div class="vuln-item-actions">
                                        <div class="vuln-item-level high">é«˜å±</div>
                                        <button class="ai-analyze-btn" onclick="analyzeVulnerability('è¿œç¨‹ä»£ç æ‰§è¡Œ(RCE)', this)">
                                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 10 10 0 0 0-10-10z"/>
                                                <path d="M8.5 14.5 12 11l3.5 3.5"/>
                                            </svg>
                                            AIåˆ†æ
                                        </button>
                                    </div>
                                </div>
                                <div class="vuln-item-desc">
                                    åå°æ¨¡æ¿ç¼–è¾‘åŠŸèƒ½å­˜åœ¨ä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´ï¼Œæ”»å‡»è€…ç™»å½•åå°åå¯ç›´æ¥å†™å…¥WebShellï¼Œè·å–æœåŠ¡å™¨å®Œæ•´æ§åˆ¶æƒé™ã€‚
                                </div>
                                <div class="vuln-item-meta">
                                    <span>CVE-2022-41842</span>
                                    <span>å½±å“ç‰ˆæœ¬: v8.x - v10.x</span>
                                    <span>CVSS: 9.1</span>
                                </div>
                                <div class="ai-analysis">
                                    <div class="ai-analysis-header">
                                        <div class="ai-analysis-icon">AI</div>
                                        <div class="ai-analysis-title">AI åˆ†æå»ºè®®</div>
                                    </div>
                                    <div class="ai-analysis-content">
                                        RCEæ¼æ´é£é™©æé«˜ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ²¦é™·ã€‚å»ºè®®ï¼š1) é™åˆ¶åå°è®¿é—®IPç™½åå•ï¼›2) ä¿®æ”¹é»˜è®¤åå°è·¯å¾„ï¼›3) ç¦ç”¨æ¨¡æ¿åœ¨çº¿ç¼–è¾‘åŠŸèƒ½ï¼›4) å®šæœŸå®¡è®¡åå°æ“ä½œæ—¥å¿—ã€‚
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- å­åŸŸå/æ—ç«™åŒºåŸŸ -->
                        <div class="subdomain-section expanded" id="subdomain-1">
                            <div class="subdomain-header" onclick="toggleSubdomain('subdomain-1')">
                                <div class="subdomain-title">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
                                    å­åŸŸå / æ—ç«™
                                    <span class="subdomain-badge">3 ä¸ªèµ„äº§</span>
                                </div>
                            </div>
                            <div class="subdomain-list">
                                <!-- å­åŸŸå1 -->
                                <div class="subdomain-item">
                                    <div class="subdomain-item-header">
                                        <div class="subdomain-item-left">
                                            <div class="subdomain-item-icon">
                                                <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                                            </div>
                                            <div class="subdomain-item-url"><a href="https://api.movie.example1.com" target="_blank">api.movie.example1.com</a></div>
                                            <span class="subdomain-item-type subdomain">å­åŸŸå</span>
                                        </div>
                                        <div class="site-header-right">
                                            <div class="site-vuln-count high"><span class="count-dot"></span> 1</div>
                                        </div>
                                    </div>
                                    <div class="vuln-list">
                                        <div class="vuln-item">
                                            <div class="vuln-item-header">
                                                <div class="vuln-item-title">APIæ¥å£æœªæˆæƒè®¿é—®</div>
                                                <div class="vuln-item-actions">
                                                    <div class="vuln-item-level high">é«˜å±</div>
                                                    <button class="ai-analyze-btn" onclick="analyzeVulnerability('APIæ¥å£æœªæˆæƒè®¿é—®', this)">
                                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <path d="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 10 10 0 0 0-10-10z"/>
                                                            <path d="M8.5 14.5 12 11l3.5 3.5"/>
                                                        </svg>
                                                        AIåˆ†æ
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="vuln-item-desc">
                                                APIæ¥å£ç¼ºå°‘èº«ä»½éªŒè¯ï¼Œæ”»å‡»è€…å¯ç›´æ¥è°ƒç”¨æ•æ„Ÿæ¥å£è·å–ç”¨æˆ·æ•°æ®ã€ä¿®æ”¹ç³»ç»Ÿé…ç½®ã€‚
                                            </div>
                                            <div class="vuln-item-meta">
                                                <span>è·¯å¾„: /api/user/list</span>
                                                <span>å½±å“: æ•°æ®æ³„éœ²</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- å­åŸŸå2 -->
                                <div class="subdomain-item">
                                    <div class="subdomain-item-header">
                                        <div class="subdomain-item-left">
                                            <div class="subdomain-item-icon">
                                                <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                                            </div>
                                            <div class="subdomain-item-url"><a href="https://admin.movie.example1.com" target="_blank">admin.movie.example1.com</a></div>
                                            <span class="subdomain-item-type subdomain">å­åŸŸå</span>
                                        </div>
                                        <div class="site-header-right">
                                            <div class="site-vuln-count medium"><span class="count-dot"></span> 1</div>
                                        </div>
                                    </div>
                                    <div class="vuln-list">
                                        <div class="vuln-item">
                                            <div class="vuln-item-header">
                                                <div class="vuln-item-title">åå°å¼±å£ä»¤</div>
                                                <div class="vuln-item-actions">
                                                    <div class="vuln-item-level medium">ä¸­å±</div>
                                                    <button class="ai-analyze-btn" onclick="analyzeVulnerability('åå°å¼±å£ä»¤', this)">
                                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <path d="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 10 10 0 0 0-10-10z"/>
                                                            <path d="M8.5 14.5 12 11l3.5 3.5"/>
                                                        </svg>
                                                        AIåˆ†æ
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="vuln-item-desc">
                                                åå°ç™»å½•ä½¿ç”¨é»˜è®¤å¼±å£ä»¤ admin/admin123ï¼Œå¯è¢«æš´åŠ›ç ´è§£è·å–ç®¡ç†å‘˜æƒé™ã€‚
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- æ—ç«™ -->
                                <div class="subdomain-item">
                                    <div class="subdomain-item-header">
                                        <div class="subdomain-item-left">
                                            <div class="subdomain-item-icon">
                                                <svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 21V9"/></svg>
                                            </div>
                                            <div class="subdomain-item-url"><a href="https://forum.example1.com" target="_blank">forum.example1.com</a></div>
                                            <span class="subdomain-item-type sidesite">æ—ç«™</span>
                                        </div>
                                        <div class="site-header-right">
                                            <div class="site-vuln-count medium"><span class="count-dot"></span> 1</div>
                                        </div>
                                    </div>
                                    <div class="vuln-list">
                                        <div class="vuln-item">
                                            <div class="vuln-item-header">
                                                <div class="vuln-item-title">XSSè·¨ç«™è„šæœ¬æ¼æ´</div>
                                                <div class="vuln-item-actions">
                                                    <div class="vuln-item-level medium">ä¸­å±</div>
                                                    <button class="ai-analyze-btn" onclick="analyzeVulnerability('XSSè·¨ç«™è„šæœ¬æ¼æ´', this)">
                                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <path d="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 10 10 0 0 0-10-10z"/>
                                                            <path d="M8.5 14.5 12 11l3.5 3.5"/>
                                                        </svg>
                                                        AIåˆ†æ
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="vuln-item-desc">
                                                è®ºå›è¯„è®ºåŠŸèƒ½å­˜åœ¨å­˜å‚¨å‹XSSæ¼æ´ï¼Œå¯çªƒå–ç”¨æˆ·Cookieå’Œä¼šè¯ä¿¡æ¯ã€‚
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ç½‘ç«™2 -->
                <div class="site-card" id="site-2">
                    <div class="site-header" onclick="toggleSite('site-2')">
                        <div class="site-header-left">
                            <div class="site-expand-icon">
                                <svg viewBox="0 0 24 24"><path d="M9 18l6-6-6-6"/></svg>
                            </div>
                            <div class="site-info">
                                <div class="site-url"><a href="https://video.example2.cn" target="_blank">video.example2.cn</a></div>
                                <div class="site-meta">
                                    <span>IP: 192.168.1.101</span>
                                    <span>è‹¹æœCMS V10</span>
                                    <span>æœ€åæ‰«æ: 2024-01-15 14:25</span>
                                </div>
                            </div>
                        </div>
                        <div class="site-header-right">
                            <div class="site-vuln-count high"><span class="count-dot"></span> 2 é«˜å±</div>
                            <div class="site-vuln-count medium"><span class="count-dot"></span> 3 ä¸­å±</div>
                            <div class="site-vuln-count low"><span class="count-dot"></span> 1 ä½å±</div>
                        </div>
                    </div>
                    <div class="site-body">
                        <div class="vuln-list">
                            <div class="vuln-item">
                                <div class="vuln-item-header">
                                    <div class="vuln-item-title">ç›®å½•éå†æ¼æ´</div>
                                    <div class="vuln-item-actions">
                                        <div class="vuln-item-level medium">ä¸­å±</div>
                                        <button class="ai-analyze-btn" onclick="analyzeVulnerability('ç›®å½•éå†æ¼æ´', this)">
                                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 10 10 0 0 0-10-10z"/>
                                                <path d="M8.5 14.5 12 11l3.5 3.5"/>
                                            </svg>
                                            AIåˆ†æ
                                        </button>
                                    </div>
                                </div>
                                <div class="vuln-item-desc">
                                    ä¸‹è½½åŠŸèƒ½å­˜åœ¨è·¯å¾„éå†æ¼æ´ï¼Œæ”»å‡»è€…å¯è¯»å–æœåŠ¡å™¨ä»»æ„æ–‡ä»¶ï¼ŒåŒ…æ‹¬æ•°æ®åº“é…ç½®ã€æºç ç­‰æ•æ„Ÿä¿¡æ¯ã€‚
                                </div>
                                <div class="vuln-item-meta">
                                    <span>CVE-2021-32156</span>
                                    <span>å½±å“ç‰ˆæœ¬: v8.x - v10.x</span>
                                    <span>CVSS: 6.5</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ç½‘ç«™3 -->
                <div class="site-card" id="site-3">
                    <div class="site-header" onclick="toggleSite('site-3')">
                        <div class="site-header-left">
                            <div class="site-expand-icon">
                                <svg viewBox="0 0 24 24"><path d="M9 18l6-6-6-6"/></svg>
                            </div>
                            <div class="site-info">
                                <div class="site-url"><a href="https://film.example3.net" target="_blank">film.example3.net</a></div>
                                <div class="site-meta">
                                    <span>IP: 192.168.1.102</span>
                                    <span>è‹¹æœCMS V10</span>
                                    <span>æœ€åæ‰«æ: 2024-01-15 14:20</span>
                                </div>
                            </div>
                        </div>
                        <div class="site-header-right">
                            <div class="site-vuln-count medium"><span class="count-dot"></span> 2 ä¸­å±</div>
                            <div class="site-vuln-count low"><span class="count-dot"></span> 3 ä½å±</div>
                        </div>
                    </div>
                    <div class="site-body">
                        <div class="vuln-list">
                            <div class="vuln-item">
                                <div class="vuln-item-header">
                                    <div class="vuln-item-title">XSSè·¨ç«™è„šæœ¬æ¼æ´</div>
                                    <div class="vuln-item-actions">
                                        <div class="vuln-item-level medium">ä¸­å±</div>
                                        <button class="ai-analyze-btn" onclick="analyzeVulnerability('XSSè·¨ç«™è„šæœ¬æ¼æ´', this)">
                                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 10 10 0 0 0-10-10z"/>
                                                <path d="M8.5 14.5 12 11l3.5 3.5"/>
                                            </svg>
                                            AIåˆ†æ
                                        </button>
                                    </div>
                                </div>
                                <div class="vuln-item-desc">
                                    æœç´¢åŠŸèƒ½å­˜åœ¨åå°„å‹XSSæ¼æ´ï¼Œæ”»å‡»è€…å¯æ„é€ æ¶æ„é“¾æ¥ï¼Œçªƒå–ç”¨æˆ·Cookieã€ä¼šè¯ä¿¡æ¯ã€‚
                                </div>
                                <div class="vuln-item-meta">
                                    <span>CVE-2022-28456</span>
                                    <span>å½±å“ç‰ˆæœ¬: v10.x</span>
                                    <span>CVSS: 5.4</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- AI å¯¹è¯é¢æ¿ -->
    <div class="ai-panel" id="aiPanel">
        <div class="ai-header">
            <div class="ai-title">AI å®‰å…¨åŠ©æ‰‹</div>
        </div>
        <div class="ai-shortcuts">
            <button class="ai-shortcut" onclick="aiQuickAction('summary')">ç”Ÿæˆæ‘˜è¦</button>
            <button class="ai-shortcut" onclick="aiQuickAction('fix')">ä¿®å¤å»ºè®®</button>
            <button class="ai-shortcut" onclick="aiQuickAction('priority')">ä¼˜å…ˆçº§æ’åº</button>
            <button class="ai-shortcut" onclick="aiQuickAction('report')">ç”ŸæˆæŠ¥å‘Š</button>
        </div>
        <div class="ai-body" id="aiMessages">
            <div class="ai-message assistant">ä½ å¥½ï¼æˆ‘æ˜¯ AI å®‰å…¨åŠ©æ‰‹ï¼Œå¯ä»¥å¸®ä½ ï¼š<br>â€¢ åˆ†ææ¼æ´å½±å“èŒƒå›´<br>â€¢ ç”Ÿæˆä¿®å¤ä¼˜å…ˆçº§å»ºè®®<br>â€¢ å¯¼å‡ºä¸“ä¸šå®‰å…¨æŠ¥å‘Š<br>â€¢ è§£ç­”å®‰å…¨ç›¸å…³é—®é¢˜<br><br>è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„ï¼Ÿ</div>
        </div>
        <div class="ai-footer">
            <div class="ai-tools">
                <button class="tool-btn" onclick="location.href='index.html'" title="è¿”å›æ‰«æ">
                    <svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
                    <span>ç»§ç»­æ‰«æ</span>
                </button>
                <button class="tool-btn" onclick="exportReport()" title="å¯¼å‡ºæŠ¥å‘Š">
                    <svg viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
                    <span>å¯¼å‡ºæŠ¥å‘Š</span>
                </button>
            </div>
            <div class="ai-input-wrap">
                <textarea class="ai-input" id="aiInput" rows="1" placeholder="è¯¢é—®æ¼æ´åˆ†æå»ºè®®..." oninput="autoResize(this)"></textarea>
                <button class="ai-send" onclick="sendAiMessage()">
                    <svg viewBox="0 0 24 24"><path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/></svg>
                </button>
            </div>
        </div>
    </div>

    <script>
        /* AIæ¼æ´åˆ†æé¡µé¢ JavaScript */

        // åˆ‡æ¢ç½‘ç«™å±•å¼€/æ”¶èµ·
        function toggleSite(siteId) {
            const card = document.getElementById(siteId);
            if (card) {
                card.classList.toggle('expanded');
            }
        }

        // åˆ‡æ¢å­åŸŸååŒºåŸŸå±•å¼€/æ”¶èµ·
        function toggleSubdomain(subdomainId) {
            const section = document.getElementById(subdomainId);
            if (section) {
                section.classList.toggle('expanded');
            }
        }

        // åˆ·æ–°åˆ†æ
        function refreshAnalysis() {
            addAiMessage(null, 'æ­£åœ¨åˆ·æ–°æ¼æ´åˆ†ææ•°æ®...');
            setTimeout(() => {
                addAiMessage(null, 'âœ… åˆ†ææ•°æ®å·²æ›´æ–°ï¼å‘ç° 12 ä¸ªç«™ç‚¹ï¼Œå…± 52 ä¸ªæ¼æ´ã€‚');
            }, 1000);
        }

        // AIæ·±åº¦åˆ†æ
        function startAiAnalysis() {
            addAiMessage(null, 'ğŸ¤– æ­£åœ¨è¿›è¡Œ AI æ·±åº¦åˆ†æ...<br><br>åˆ†æå†…å®¹åŒ…æ‹¬ï¼š<br>â€¢ æ¼æ´å…³è”æ€§åˆ†æ<br>â€¢ æ”»å‡»é“¾è·¯æ¨æ¼”<br>â€¢ é£é™©è¯„ä¼°ä¼˜å…ˆçº§<br>â€¢ æ™ºèƒ½ä¿®å¤å»ºè®®');
            
            setTimeout(() => {
                addAiMessage(null, `<strong>ğŸ“Š AI æ·±åº¦åˆ†ææŠ¥å‘Š</strong><br><br>
<strong>1. é«˜å±é£é™©ä¼˜å…ˆå¤„ç†</strong><br>
â€¢ movie.example1.com - SQLæ³¨å…¥ï¼ˆå»ºè®®ç«‹å³ä¿®å¤ï¼‰<br>
â€¢ movie.example1.com - RCEï¼ˆå»ºè®®24å°æ—¶å†…ä¿®å¤ï¼‰<br><br>
<strong>2. æ”»å‡»é“¾è·¯åˆ†æ</strong><br>
å‘ç°æ½œåœ¨æ”»å‡»è·¯å¾„ï¼šSQLæ³¨å…¥ â†’ è·å–åå°å‡­æ® â†’ RCEè·å–æœåŠ¡å™¨æƒé™<br><br>
<strong>3. ä¿®å¤ä¼˜å…ˆçº§å»ºè®®</strong><br>
P0: SQLæ³¨å…¥ã€RCEï¼ˆ2ä¸ªï¼‰<br>
P1: æœªæˆæƒè®¿é—®ã€å¼±å£ä»¤ï¼ˆ2ä¸ªï¼‰<br>
P2: XSSã€ç›®å½•éå†ï¼ˆ3ä¸ªï¼‰`);
            }, 2000);
        }

        // å¯¼å‡ºæŠ¥å‘Š
        function exportReport() {
            addAiMessage(null, 'ğŸ“„ æ­£åœ¨ç”Ÿæˆæ¼æ´åˆ†ææŠ¥å‘Š...');
            setTimeout(() => {
                addAiMessage(null, 'âœ… æŠ¥å‘Šå·²ç”Ÿæˆï¼åŒ…å« 12 ä¸ªç«™ç‚¹ã€52 ä¸ªæ¼æ´çš„å®Œæ•´åˆ†æã€‚<br><br>æŠ¥å‘Šæ ¼å¼ï¼šHTML / PDF / Markdown');
            }, 1500);
        }

        // AIå¿«æ·æ“ä½œ
        function aiQuickAction(type) {
            const actions = {
                'summary': {
                    user: 'ç”Ÿæˆæ¼æ´æ‘˜è¦',
                    response: `<strong>ğŸ“‹ æ¼æ´æ‘˜è¦</strong><br><br>
æ‰«æç«™ç‚¹ï¼š12 ä¸ª<br>
æ€»æ¼æ´æ•°ï¼š52 ä¸ª<br><br>
<strong>é£é™©åˆ†å¸ƒï¼š</strong><br>
â€¢ é«˜å±ï¼š8 ä¸ª (15.4%)<br>
â€¢ ä¸­å±ï¼š15 ä¸ª (28.8%)<br>
â€¢ ä½å±ï¼š6 ä¸ª (11.5%)<br>
â€¢ ä¿¡æ¯ï¼š23 ä¸ª (44.2%)<br><br>
<strong>æœ€ä¸¥é‡æ¼æ´ï¼š</strong><br>
SQLæ³¨å…¥ï¼ˆmovie.example1.comï¼‰- CVSS 9.8`
                },
                'fix': {
                    user: 'ç”Ÿæˆä¿®å¤å»ºè®®',
                    response: `<strong>ğŸ”§ ä¿®å¤å»ºè®®</strong><br><br>
<strong>ç«‹å³ä¿®å¤ï¼ˆ24å°æ—¶å†…ï¼‰ï¼š</strong><br>
1. SQLæ³¨å…¥ - å‡çº§CMSç‰ˆæœ¬ï¼Œä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢<br>
2. RCEæ¼æ´ - ç¦ç”¨æ¨¡æ¿åœ¨çº¿ç¼–è¾‘ï¼Œé™åˆ¶åå°IP<br><br>
<strong>å°½å¿«ä¿®å¤ï¼ˆä¸€å‘¨å†…ï¼‰ï¼š</strong><br>
3. APIæœªæˆæƒ - æ·»åŠ JWTèº«ä»½éªŒè¯<br>
4. å¼±å£ä»¤ - å¼ºåˆ¶å¯†ç ç­–ç•¥ï¼Œå¯ç”¨2FA<br><br>
<strong>è®¡åˆ’ä¿®å¤ï¼š</strong><br>
5. XSSæ¼æ´ - è¾“å…¥è¾“å‡ºè¿‡æ»¤ï¼ŒCSPç­–ç•¥<br>
6. ç›®å½•éå† - è·¯å¾„è¿‡æ»¤ï¼Œç™½åå•é™åˆ¶`
                },
                'priority': {
                    user: 'æ¼æ´ä¼˜å…ˆçº§æ’åº',
                    response: `<strong>ğŸ“Š æ¼æ´ä¼˜å…ˆçº§æ’åº</strong><br><br>
<strong>ğŸ”´ P0 - ç´§æ€¥ï¼ˆç«‹å³å¤„ç†ï¼‰</strong><br>
â€¢ SQLæ³¨å…¥ Ã— 2<br>
â€¢ è¿œç¨‹ä»£ç æ‰§è¡Œ Ã— 2<br><br>
<strong>ğŸŸ  P1 - é«˜ä¼˜å…ˆçº§</strong><br>
â€¢ APIæœªæˆæƒè®¿é—® Ã— 1<br>
â€¢ åå°å¼±å£ä»¤ Ã— 2<br><br>
<strong>ğŸŸ¡ P2 - ä¸­ä¼˜å…ˆçº§</strong><br>
â€¢ XSSè·¨ç«™è„šæœ¬ Ã— 5<br>
â€¢ ç›®å½•éå† Ã— 3<br><br>
<strong>ğŸŸ¢ P3 - ä½ä¼˜å…ˆçº§</strong><br>
â€¢ ä¿¡æ¯æ³„éœ² Ã— 23`
                },
                'report': {
                    user: 'ç”Ÿæˆå®‰å…¨æŠ¥å‘Š',
                    response: 'ğŸ“„ æ­£åœ¨ç”Ÿæˆå®Œæ•´å®‰å…¨è¯„ä¼°æŠ¥å‘Š...<br><br>æŠ¥å‘Šå°†åŒ…å«ï¼š<br>â€¢ æ‰§è¡Œæ‘˜è¦<br>â€¢ æ¼æ´è¯¦æƒ…<br>â€¢ é£é™©è¯„ä¼°<br>â€¢ ä¿®å¤å»ºè®®<br>â€¢ åˆè§„æ£€æŸ¥<br><br>é¢„è®¡ç”Ÿæˆæ—¶é—´ï¼š30ç§’'
                }
            };

            const action = actions[type];
            if (action) {
                addAiMessage(action.user, action.response);
            }
        }

        // é‡å†™ sendAiMessage ä»¥é€‚é…æœ¬é¡µé¢
        function sendAiMessage() {
            const input = document.getElementById('aiInput');
            const messagesDiv = document.getElementById('aiMessages');
            if (!input || !messagesDiv) return;
            
            const text = input.value.trim();
            if (!text) return;
            
            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
            const userMsg = document.createElement('div');
            userMsg.className = 'ai-message user';
            userMsg.textContent = text;
            messagesDiv.appendChild(userMsg);
            
            // æ¨¡æ‹ŸAIå›å¤
            setTimeout(() => {
                const aiMsg = document.createElement('div');
                aiMsg.className = 'ai-message assistant';
                aiMsg.innerHTML = generateAiResponse(text);
                messagesDiv.appendChild(aiMsg);
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }, 500);
            
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            input.value = '';
        }

        // ç”ŸæˆAIå›å¤
        function generateAiResponse(message) {
            const msg = message.toLowerCase();
            
            if (msg.includes('ä¿®å¤') || msg.includes('fix')) {
                return 'æ ¹æ®æ¼æ´åˆ†æï¼Œå»ºè®®ä¼˜å…ˆä¿®å¤ SQLæ³¨å…¥ å’Œ RCE æ¼æ´ï¼Œè¿™ä¸¤ä¸ªæ¼æ´å¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®Œå…¨æ²¦é™·ã€‚å…·ä½“ä¿®å¤æ–¹æ¡ˆå·²åœ¨å„æ¼æ´è¯¦æƒ…ä¸­çš„ AI åˆ†æå»ºè®®ä¸­ç»™å‡ºã€‚';
            }
            if (msg.includes('ä¼˜å…ˆ') || msg.includes('priority')) {
                return 'æ¼æ´ä¿®å¤ä¼˜å…ˆçº§å»ºè®®ï¼š<br>1. SQLæ³¨å…¥ï¼ˆCVSS 9.8ï¼‰<br>2. RCEè¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆCVSS 9.1ï¼‰<br>3. APIæœªæˆæƒè®¿é—®<br>4. å…¶ä»–ä¸­ä½å±æ¼æ´';
            }
            if (msg.includes('æŠ¥å‘Š') || msg.includes('report')) {
                return 'æˆ‘å¯ä»¥å¸®ä½ ç”Ÿæˆå¤šç§æ ¼å¼çš„å®‰å…¨æŠ¥å‘Šï¼š<br>â€¢ HTML åœ¨çº¿æŠ¥å‘Š<br>â€¢ PDF æ­£å¼æŠ¥å‘Š<br>â€¢ Markdown æŠ€æœ¯æ–‡æ¡£<br><br>è¯·ç‚¹å‡»ä¸Šæ–¹"å¯¼å‡ºæŠ¥å‘Š"æŒ‰é’®é€‰æ‹©æ ¼å¼ã€‚';
            }
            
            return `æˆ‘ç†è§£ä½ æƒ³äº†è§£ã€Œ${escapeHtml(message)}ã€ç›¸å…³å†…å®¹ã€‚<br><br>ä½ å¯ä»¥å°è¯•ï¼š<br>â€¢ ç‚¹å‡»å¿«æ·æŒ‰é’®è·å–åˆ†æ<br>â€¢ è¯¢é—®å…·ä½“æ¼æ´çš„ä¿®å¤æ–¹æ¡ˆ<br>â€¢ è¯·æ±‚ç”Ÿæˆå®‰å…¨æŠ¥å‘Š`;
        }
        
        // æœç´¢æ¼æ´åŠŸèƒ½
        function searchVulnerabilities() {
            const searchInput = document.getElementById('floatingVulnSearch') || document.getElementById('vulnSearch');
            const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
            if (!searchTerm) {
                // å¦‚æœæœç´¢æ¡†ä¸ºç©ºï¼Œæ˜¾ç¤ºæ‰€æœ‰æ¼æ´
                showAllVulnerabilities();
                return;
            }
            
            // éšè—æ‰€æœ‰æ¼æ´
            document.querySelectorAll('.vuln-item').forEach(item => {
                item.style.display = 'none';
            });
            
            // éšè—æ‰€æœ‰ç½‘ç«™å¡ç‰‡
            document.querySelectorAll('.site-card').forEach(card => {
                card.style.display = 'none';
            });
            
            // éšè—æ‰€æœ‰å­åŸŸå
            document.querySelectorAll('.subdomain-item').forEach(item => {
                item.style.display = 'none';
            });
            
            // æœç´¢å¹¶æ˜¾ç¤ºåŒ¹é…çš„æ¼æ´
            document.querySelectorAll('.vuln-item').forEach(item => {
                const title = item.querySelector('.vuln-item-title')?.textContent.toLowerCase() || '';
                const desc = item.querySelector('.vuln-item-desc')?.textContent.toLowerCase() || '';
                const meta = item.querySelector('.vuln-item-meta')?.textContent.toLowerCase() || '';
                
                if (title.includes(searchTerm) || desc.includes(searchTerm) || meta.includes(searchTerm)) {
                    item.style.display = 'block';
                    
                    // æ˜¾ç¤ºæ¼æ´æ‰€åœ¨çš„ç½‘ç«™
                    let parent = item.closest('.site-card');
                    if (parent) {
                        parent.style.display = 'block';
                        parent.classList.add('expanded'); // å±•å¼€å¡ç‰‡
                    }
                    
                    // æ˜¾ç¤ºæ¼æ´æ‰€åœ¨çš„å­åŸŸåï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                    parent = item.closest('.subdomain-item');
                    if (parent) {
                        parent.style.display = 'block';
                        parent.closest('.subdomain-section')?.classList.add('expanded');
                    }
                }
            });
            
            // æœç´¢å¹¶æ˜¾ç¤ºåŒ¹é…çš„ç½‘ç«™
            document.querySelectorAll('.site-info').forEach(info => {
                const url = info.querySelector('.site-url a')?.textContent.toLowerCase() || '';
                const meta = info.querySelector('.site-meta')?.textContent.toLowerCase() || '';
                
                if (url.includes(searchTerm) || meta.includes(searchTerm)) {
                    let parent = info.closest('.site-card');
                    if (parent) {
                        parent.style.display = 'block';
                        parent.classList.add('expanded'); // å±•å¼€å¡ç‰‡
                    }
                }
            });
            
            // æœç´¢å¹¶æ˜¾ç¤ºåŒ¹é…çš„å­åŸŸå
            document.querySelectorAll('.subdomain-item-url').forEach(urlElement => {
                const url = urlElement.querySelector('a')?.textContent.toLowerCase() || '';
                
                if (url.includes(searchTerm)) {
                    let parent = urlElement.closest('.subdomain-item');
                    if (parent) {
                        parent.style.display = 'block';
                        const subSection = parent.closest('.subdomain-section');
                        if (subSection) subSection.classList.add('expanded');
                        const siteCard = parent.closest('.site-card');
                        if (siteCard) siteCard.style.display = 'block';
                    }
                }
            });
        }
        
        // æ˜¾ç¤ºæ‰€æœ‰æ¼æ´
        function showAllVulnerabilities() {
            document.querySelectorAll('.vuln-item, .site-card, .subdomain-item').forEach(item => {
                item.style.display = '';
            });
        }
        
        // ä¸ºæœç´¢æ¡†æ·»åŠ å›è½¦é”®æ”¯æŒå’Œå®æ—¶æœç´¢
        document.getElementById('floatingVulnSearch')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchVulnerabilities();
            }
        });
        
        // å®æ—¶æœç´¢ï¼ˆå½“ç”¨æˆ·è¾“å…¥æ—¶è‡ªåŠ¨æœç´¢ï¼‰
        document.getElementById('floatingVulnSearch')?.addEventListener('input', function() {
            // ä½¿ç”¨é˜²æŠ–åŠŸèƒ½ï¼Œé¿å…é¢‘ç¹æœç´¢
            clearTimeout(this.searchTimeout);
            this.searchTimeout = setTimeout(() => {
                searchVulnerabilities();
            }, 300);
        });
        
        // åˆ†æå•ä¸ªæ¼æ´
        function analyzeVulnerability(vulnTitle, button) {
            // æ·»åŠ AIæ¶ˆæ¯åˆ°å¯¹è¯é¢æ¿
            const message = `åˆ†ææ¼æ´: ${vulnTitle}`;
            addAiMessage(message, `ğŸ¤– æ­£åœ¨å¯¹æ¼æ´ã€Œ${vulnTitle}ã€è¿›è¡Œæ·±åº¦åˆ†æ...`);
            
            // æ¨¡æ‹ŸAIåˆ†æè¿‡ç¨‹
            setTimeout(() => {
                // æ ¹æ®æ¼æ´ç±»å‹ç”Ÿæˆä¸åŒçš„åˆ†æç»“æœ
                let analysisResult = '';
                if (vulnTitle.includes('SQL')) {
                    analysisResult = `ğŸ” <strong>SQLæ³¨å…¥æ¼æ´åˆ†æ</strong><br><br>
                    <strong>é£é™©ç­‰çº§ï¼š</strong>é«˜å±<br>
                    <strong>å½±å“èŒƒå›´ï¼š</strong>æ•°æ®åº“å®Œæ•´æƒé™å¯èƒ½è¢«è·å–<br>
                    <strong>ä¿®å¤å»ºè®®ï¼š</strong><br>
                    1. ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢æˆ–é¢„ç¼–è¯‘è¯­å¥<br>
                    2. å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œä¸¥æ ¼çš„éªŒè¯å’Œè¿‡æ»¤<br>
                    3. é™åˆ¶æ•°æ®åº“è´¦æˆ·æƒé™<br>
                    4. éƒ¨ç½²WAFè§„åˆ™æ‹¦æˆªSQLæ³¨å…¥æ”»å‡»<br><br>
                    <strong>ä¿®å¤ä¼˜å…ˆçº§ï¼š</strong>ç«‹å³å¤„ç† (P0)`;
                } else if (vulnTitle.includes('RCE') || vulnTitle.includes('ä»£ç æ‰§è¡Œ')) {
                    analysisResult = `ğŸ” <strong>è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æ</strong><br><br>
                    <strong>é£é™©ç­‰çº§ï¼š</strong>é«˜å±<br>
                    <strong>å½±å“èŒƒå›´ï¼š</strong>æœåŠ¡å™¨å®Œå…¨æ§åˆ¶æƒå¯èƒ½è¢«è·å–<br>
                    <strong>ä¿®å¤å»ºè®®ï¼š</strong><br>
                    1. é™åˆ¶åå°è®¿é—®IPç™½åå•<br>
                    2. ä¿®æ”¹é»˜è®¤åå°è·¯å¾„<br>
                    3. ç¦ç”¨æ¨¡æ¿åœ¨çº¿ç¼–è¾‘åŠŸèƒ½<br>
                    4. å¯ç”¨æ–‡ä»¶ä¸Šä¼ é™åˆ¶<br><br>
                    <strong>ä¿®å¤ä¼˜å…ˆçº§ï¼š</strong>24å°æ—¶å†…å¤„ç† (P0)`;
                } else if (vulnTitle.includes('XSS')) {
                    analysisResult = `ğŸ” <strong>XSSè·¨ç«™è„šæœ¬æ¼æ´åˆ†æ</strong><br><br>
                    <strong>é£é™©ç­‰çº§ï¼š</strong>ä¸­å±<br>
                    <strong>å½±å“èŒƒå›´ï¼š</strong>ç”¨æˆ·ä¼šè¯å¯èƒ½è¢«åŠ«æŒ<br>
                    <strong>ä¿®å¤å»ºè®®ï¼š</strong><br>
                    1. å¯¹è¾“å‡ºå†…å®¹è¿›è¡ŒHTMLç¼–ç <br>
                    2. è®¾ç½®HTTPOnly Cookie<br>
                    3. å®æ–½å†…å®¹å®‰å…¨ç­–ç•¥(CSP)<br>
                    4. è¾“å…¥è¿‡æ»¤å’ŒéªŒè¯<br><br>
                    <strong>ä¿®å¤ä¼˜å…ˆçº§ï¼š</strong>ä¸€å‘¨å†…å¤„ç† (P2)`;
                } else if (vulnTitle.includes('å¼±å£ä»¤')) {
                    analysisResult = `ğŸ” <strong>å¼±å£ä»¤æ¼æ´åˆ†æ</strong><br><br>
                    <strong>é£é™©ç­‰çº§ï¼š</strong>ä¸­å±<br>
                    <strong>å½±å“èŒƒå›´ï¼š</strong>åå°æƒé™å¯èƒ½è¢«è·å–<br>
                    <strong>ä¿®å¤å»ºè®®ï¼š</strong><br>
                    1. å¼ºåˆ¶ä¿®æ”¹é»˜è®¤å£ä»¤<br>
                    2. å®æ–½å¼ºå¯†ç ç­–ç•¥<br>
                    3. å¯ç”¨è´¦æˆ·é”å®šæœºåˆ¶<br>
                    4. å¯ç”¨åŒå› ç´ è®¤è¯<br><br>
                    <strong>ä¿®å¤ä¼˜å…ˆçº§ï¼š</strong>ä¸€å‘¨å†…å¤„ç† (P1)`;
                } else if (vulnTitle.includes('æœªæˆæƒè®¿é—®')) {
                    analysisResult = `ğŸ” <strong>æœªæˆæƒè®¿é—®æ¼æ´åˆ†æ</strong><br><br>
                    <strong>é£é™©ç­‰çº§ï¼š</strong>é«˜å±<br>
                    <strong>å½±å“èŒƒå›´ï¼š</strong>æ•æ„Ÿæ•°æ®å¯èƒ½è¢«ç›´æ¥è®¿é—®<br>
                    <strong>ä¿®å¤å»ºè®®ï¼š</strong><br>
                    1. å®æ–½èº«ä»½éªŒè¯æœºåˆ¶<br>
                    2. æ·»åŠ æƒé™æ§åˆ¶æ£€æŸ¥<br>
                    3. éªŒè¯ç”¨æˆ·ä¼šè¯çŠ¶æ€<br>
                    4. å®æ–½è®¿é—®æ—¥å¿—è®°å½•<br><br>
                    <strong>ä¿®å¤ä¼˜å…ˆçº§ï¼š</strong>24å°æ—¶å†…å¤„ç† (P0)`;
                } else if (vulnTitle.includes('ç›®å½•éå†')) {
                    analysisResult = `ğŸ” <strong>ç›®å½•éå†æ¼æ´åˆ†æ</strong><br><br>
                    <strong>é£é™©ç­‰çº§ï¼š</strong>ä¸­å±<br>
                    <strong>å½±å“èŒƒå›´ï¼š</strong>æœåŠ¡å™¨æ•æ„Ÿæ–‡ä»¶å¯èƒ½è¢«è¯»å–<br>
                    <strong>ä¿®å¤å»ºè®®ï¼š</strong><br>
                    1. éªŒè¯å’Œè¿‡æ»¤æ–‡ä»¶è·¯å¾„å‚æ•°<br>
                    2. å®æ–½è·¯å¾„ç™½åå•æœºåˆ¶<br>
                    3. ç¦æ­¢è®¿é—®æ•æ„Ÿç›®å½•<br>
                    4. å®æ–½æ–‡ä»¶è®¿é—®æƒé™æ§åˆ¶<br><br>
                    <strong>ä¿®å¤ä¼˜å…ˆçº§ï¼š</strong>ä¸€å‘¨å†…å¤„ç† (P2)`;
                } else {
                    analysisResult = `ğŸ” <strong>æ¼æ´åˆ†æç»“æœ</strong><br><br>
                    <strong>é£é™©ç­‰çº§ï¼š</strong>éœ€è¿›ä¸€æ­¥è¯„ä¼°<br>
                    <strong>å½±å“èŒƒå›´ï¼š</strong>æ ¹æ®å…·ä½“åˆ©ç”¨æ–¹å¼è€Œå®š<br>
                    <strong>ä¿®å¤å»ºè®®ï¼š</strong><br>
                    1. è¯¦ç»†åˆ†ææ¼æ´æˆå› <br>
                    2. è¯„ä¼°æ¼æ´åˆ©ç”¨éš¾åº¦<br>
                    3. åˆ¶å®šé’ˆå¯¹æ€§ä¿®å¤æ–¹æ¡ˆ<br>
                    4. ä¿®å¤åè¿›è¡Œå›å½’æµ‹è¯•<br><br>
                    <strong>ä¿®å¤ä¼˜å…ˆçº§ï¼š</strong>æ ¹æ®ä¸šåŠ¡å½±å“ç¡®å®š`;
                }
                
                addAiMessage(null, analysisResult);
            }, 1000);
            
            // æŒ‰é’®ç‚¹å‡»åé¦ˆ
            const originalText = button.innerHTML;
            button.innerHTML = 'åˆ†æä¸­...';
            button.disabled = true;
            
            setTimeout(() => {
                button.innerHTML = originalText;
                button.disabled = false;
            }, 2000);
        }
        
        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('[DEBUG] DOMContentLoaded è§¦å‘');
            console.log('[DEBUG] XHLayout:', typeof XHLayout, XHLayout);
            
            if (typeof XHLayout === 'undefined') {
                console.error('[ERROR] XHLayout æœªå®šä¹‰ï¼Œlayout.js å¯èƒ½åŠ è½½å¤±è´¥');
                return;
            }
            
            // åŠ è½½å¯¼èˆªæ ç»„ä»¶ï¼ˆå­ç›®å½•é¡µé¢éœ€è¦ basePathï¼‰
            try {
                const navbar = await XHLayout.loadNavbar({
                    activeTab: 'vuln-analysis',
                    basePath: '../'
                });
                console.log('[DEBUG] loadNavbar ç»“æœ:', navbar);
            } catch (e) {
                console.error('[ERROR] loadNavbar å¤±è´¥:', e);
            }
            
            // åŠ è½½æµ®åŠ¨å¯¼èˆªç»„ä»¶ï¼ˆå¸¦æœç´¢æ¡†ï¼‰
            try {
                const floatingNav = await XHLayout.loadFloatingNav({
                    title: 'æ¼æ´åˆ†æä»ªè¡¨ç›˜',
                    activePage: 'vuln-analysis',
                    basePath: '../',
                    extraHtml: XHLayout.FLOATING_NAV_SEARCH_HTML
                });
                console.log('[DEBUG] loadFloatingNav ç»“æœ:', floatingNav);
            } catch (e) {
                console.error('[ERROR] loadFloatingNav å¤±è´¥:', e);
            }
            
            // åŠ è½½åº•éƒ¨ç‰ˆæƒ
            XHLayout.loadFooter();
        });
    </script>
</body>
</html>
