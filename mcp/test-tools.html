<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCPå·¥å…·æµ‹è¯•ä¸­å¿ƒ - AI Red Team</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --bg-primary: #0a0e17;
            --bg-secondary: #121a2d;
            --bg-card: #1a2342;
            --accent-cyan: #00d4ff;
            --accent-green: #00ff88;
            --accent-red: #ff4757;
            --accent-yellow: #ffa502;
            --accent-purple: #a855f7;
            --text-primary: #e0e6ed;
            --text-secondary: #8892a0;
            --border-color: #2a3a5a;
        }
        
        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }
        
        /* å¤´éƒ¨æ ·å¼ */
        .header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
            padding: 20px 30px;
            border-bottom: 2px solid var(--accent-cyan);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            font-size: 2.5rem;
        }
        
        .logo h1 {
            font-size: 1.8rem;
            color: var(--accent-cyan);
            font-weight: 600;
        }
        
        .logo-sub {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .server-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: var(--bg-primary);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .status-dot.online { background: var(--accent-green); }
        .status-dot.offline { background: var(--accent-red); animation: none; }
        .status-dot.checking { background: var(--accent-yellow); }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(0.95); }
        }
        
        /* ä¸»ä½“å¸ƒå±€ */
        .main-container {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
            padding: 20px;
            max-width: 1800px;
            margin: 0 auto;
        }
        
        /* å·¥å…·çŸ©é˜µåŒºåŸŸ */
        .tools-section {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .section-title {
            font-size: 1.3rem;
            color: var(--accent-cyan);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .tool-stats {
            display: flex;
            gap: 15px;
        }
        
        .stat-item {
            padding: 5px 12px;
            background: var(--bg-primary);
            border-radius: 6px;
            font-size: 0.85rem;
        }
        
        .stat-item.success { border-left: 3px solid var(--accent-green); }
        .stat-item.failed { border-left: 3px solid var(--accent-red); }
        .stat-item.pending { border-left: 3px solid var(--accent-yellow); }
        
        /* å·¥å…·åˆ†ç±»æ ‡ç­¾ */
        .category-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }
        
        .category-tab {
            padding: 8px 16px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .category-tab:hover {
            border-color: var(--accent-cyan);
            color: var(--accent-cyan);
        }
        
        .category-tab.active {
            background: var(--accent-cyan);
            color: var(--bg-primary);
            border-color: var(--accent-cyan);
        }
        
        /* å·¥å…·æŒ‰é’®çŸ©é˜µ */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 12px;
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .tools-grid::-webkit-scrollbar {
            width: 6px;
        }
        
        .tools-grid::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }
        
        .tool-btn {
            position: relative;
            padding: 12px 15px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }
        
        .tool-btn:hover {
            border-color: var(--accent-cyan);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.2);
        }
        
        .tool-btn.running {
            border-color: var(--accent-yellow);
            animation: borderPulse 1.5s infinite;
        }
        
        .tool-btn.success {
            border-color: var(--accent-green);
        }
        
        .tool-btn.failed {
            border-color: var(--accent-red);
        }
        
        @keyframes borderPulse {
            0%, 100% { border-color: var(--accent-yellow); }
            50% { border-color: rgba(255, 165, 2, 0.5); }
        }
        
        .tool-name {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 5px;
            color: var(--text-primary);
        }
        
        .tool-category {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .tool-status {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--text-secondary);
        }
        
        .tool-status.available { background: var(--accent-green); }
        .tool-status.unavailable { background: var(--accent-red); }
        .tool-status.running { background: var(--accent-yellow); animation: pulse 1s infinite; }
        
        /* å³ä¾§é¢æ¿ */
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .panel-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
        }
        
        .panel-title {
            font-size: 1.1rem;
            color: var(--accent-cyan);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* è°ƒç”¨æµç¨‹å›¾ */
        .flow-diagram {
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 20px;
        }
        
        .flow-step {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 15px;
            margin-bottom: 8px;
            background: var(--bg-card);
            border-radius: 6px;
            border-left: 3px solid var(--accent-cyan);
        }
        
        .flow-step.active {
            border-left-color: var(--accent-green);
            background: rgba(0, 255, 136, 0.1);
        }
        
        .flow-number {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--accent-cyan);
            color: var(--bg-primary);
            border-radius: 50%;
            font-weight: bold;
            font-size: 0.85rem;
        }
        
        .flow-content {
            flex: 1;
        }
        
        .flow-title {
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .flow-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        /* ç»“æœæ˜¾ç¤ºåŒºåŸŸ */
        .result-area {
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 15px;
            font-family: 'Consolas', monospace;
            font-size: 0.85rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        .result-area::-webkit-scrollbar {
            width: 6px;
        }
        
        .result-area::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }
        
        .result-success { color: var(--accent-green); }
        .result-error { color: var(--accent-red); }
        .result-info { color: var(--accent-cyan); }
        
        /* ä¾èµ–çŠ¶æ€é¢æ¿ */
        .dependency-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .dep-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: var(--bg-primary);
            border-radius: 6px;
        }
        
        .dep-name {
            font-size: 0.85rem;
        }
        
        .dep-status {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
        }
        
        .dep-status.installed {
            background: rgba(0, 255, 136, 0.2);
            color: var(--accent-green);
        }
        
        .dep-status.missing {
            background: rgba(255, 71, 87, 0.2);
            color: var(--accent-red);
        }
        
        /* æ§åˆ¶æŒ‰é’® */
        .control-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: var(--accent-cyan);
            color: var(--bg-primary);
        }
        
        .btn-primary:hover {
            background: #00b8e6;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            border-color: var(--accent-cyan);
        }
        
        .btn-danger {
            background: var(--accent-red);
            color: white;
        }
        
        /* åº•éƒ¨çŠ¶æ€æ  */
        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            padding: 10px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .footer-info {
            display: flex;
            gap: 30px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 1fr;
            }
            
            .right-panel {
                flex-direction: row;
                flex-wrap: wrap;
            }
            
            .panel-card {
                flex: 1;
                min-width: 300px;
            }
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
            }
            
            .tools-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
            
            .category-tabs {
                overflow-x: auto;
                flex-wrap: nowrap;
                padding-bottom: 10px;
            }
        }

        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid var(--accent-cyan);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 1.3rem;
            color: var(--accent-cyan);
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .modal-close:hover {
            color: var(--accent-red);
        }
        
        /* è¾“å…¥è¡¨å• */
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .form-input {
            width: 100%;
            padding: 10px 15px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 0.9rem;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--accent-cyan);
        }
    </style>
</head>
<body>
    <!-- å¤´éƒ¨ -->
    <header class="header">
        <div class="logo">
            <span class="logo-icon">ğŸ”’</span>
            <div>
                <h1>MCPå·¥å…·æµ‹è¯•ä¸­å¿ƒ</h1>
                <span class="logo-sub">AI Red Team - å…±64ä¸ªå®‰å…¨å·¥å…·</span>
            </div>
        </div>
        <div class="server-status">
            <span class="status-dot checking" id="serverStatusDot"></span>
            <span id="serverStatusText">æ£€æŸ¥è¿æ¥ä¸­...</span>
            <span id="serverUrl">http://api.hackapt.com:5000</span>
        </div>
    </header>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="main-container">
        <!-- å·¥å…·çŸ©é˜µåŒºåŸŸ -->
        <section class="tools-section">
            <div class="section-header">
                <h2 class="section-title">
                    <span>ğŸ› ï¸</span>
                    å·¥å…·æµ‹è¯•çŸ©é˜µ
                </h2>
                <div class="tool-stats">
                    <span class="stat-item success" id="statSuccess">æˆåŠŸ: 0</span>
                    <span class="stat-item failed" id="statFailed">å¤±è´¥: 0</span>
                    <span class="stat-item pending" id="statPending">å¾…æµ‹: 64</span>
                </div>
            </div>
            
            <!-- åˆ†ç±»æ ‡ç­¾ -->
            <div class="category-tabs">
                <div class="category-tab active" data-category="all">å…¨éƒ¨ (64)</div>
                <div class="category-tab" data-category="recon">ä¿¡æ¯æ”¶é›† (20)</div>
                <div class="category-tab" data-category="vuln_scan">æ¼æ´æ‰«æ (10)</div>
                <div class="category-tab" data-category="web_attack">Webæ”»å‡» (9)</div>
                <div class="category-tab" data-category="network">ç½‘ç»œæ”»å‡» (8)</div>
                <div class="category-tab" data-category="exploit">æ¼æ´åˆ©ç”¨ (3)</div>
                <div class="category-tab" data-category="post_exploit">åæ¸—é€ (5)</div>
                <div class="category-tab" data-category="cloud">äº‘å®‰å…¨ (4)</div>
                <div class="category-tab" data-category="ai">AIè¾…åŠ© (5)</div>
            </div>
            
            <!-- å·¥å…·æŒ‰é’®ç½‘æ ¼ -->
            <div class="tools-grid" id="toolsGrid"></div>
        </section>

        <!-- å³ä¾§é¢æ¿ -->
        <aside class="right-panel">
            <!-- è°ƒç”¨æµç¨‹å›¾ -->
            <div class="panel-card">
                <h3 class="panel-title">ğŸ“Š è°ƒç”¨æµç¨‹å›¾</h3>
                <div class="flow-diagram" id="flowDiagram">
                    <div class="flow-step" data-step="1">
                        <span class="flow-number">1</span>
                        <div class="flow-content">
                            <div class="flow-title">å‰ç«¯å‘èµ·è¯·æ±‚</div>
                            <div class="flow-desc">POST /execute æˆ– /chat</div>
                        </div>
                    </div>
                    <div class="flow-step" data-step="2">
                        <span class="flow-number">2</span>
                        <div class="flow-content">
                            <div class="flow-title">MCP Server æ¥æ”¶</div>
                            <div class="flow-desc">Flask è·¯ç”±å¤„ç†</div>
                        </div>
                    </div>
                    <div class="flow-step" data-step="3">
                        <span class="flow-number">3</span>
                        <div class="flow-content">
                            <div class="flow-title">å·¥å…·æ³¨å†Œè¡¨æŸ¥è¯¢</div>
                            <div class="flow-desc">ToolRegistry.get_tool()</div>
                        </div>
                    </div>
                    <div class="flow-step" data-step="4">
                        <span class="flow-number">4</span>
                        <div class="flow-content">
                            <div class="flow-title">å‚æ•°éªŒè¯</div>
                            <div class="flow-desc">validate_params()</div>
                        </div>
                    </div>
                    <div class="flow-step" data-step="5">
                        <span class="flow-number">5</span>
                        <div class="flow-content">
                            <div class="flow-title">æœ¬åœ°å‘½ä»¤æ‰§è¡Œ</div>
                            <div class="flow-desc">subprocess.run() è°ƒç”¨æœ¬åœ°å·¥å…·</div>
                        </div>
                    </div>
                    <div class="flow-step" data-step="6">
                        <span class="flow-number">6</span>
                        <div class="flow-content">
                            <div class="flow-title">ç»“æœè¿”å›</div>
                            <div class="flow-desc">JSON æ ¼å¼å“åº”</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä¾èµ–çŠ¶æ€ -->
            <div class="panel-card">
                <h3 class="panel-title">ğŸ“¦ æœ¬åœ°å·¥å…·ä¾èµ–</h3>
                <div class="dependency-list" id="dependencyList">
                    <div class="dep-item">
                        <span class="dep-name">nmap</span>
                        <span class="dep-status missing">æ£€æµ‹ä¸­</span>
                    </div>
                </div>
                <div class="control-buttons">
                    <button class="btn btn-secondary" onclick="checkDependencies()">ğŸ”„ é‡æ–°æ£€æµ‹</button>
                </div>
            </div>

            <!-- ç»“æœæ˜¾ç¤º -->
            <div class="panel-card">
                <h3 class="panel-title">ğŸ“‹ æ‰§è¡Œç»“æœ</h3>
                <div class="result-area" id="resultArea">
<span class="result-info">ç­‰å¾…æ‰§è¡Œå·¥å…·æµ‹è¯•...</span>

<span class="result-info">â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<span class="result-info">MCP è°ƒç”¨æœºåˆ¶è¯´æ˜:</span>
<span class="result-info">â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span class="result-success">1. æœåŠ¡æ¶æ„:</span>
   MCP Server (Flask) ç›‘å¬ http://127.0.0.1:5000
   å‰ç«¯é€šè¿‡ REST API è°ƒç”¨å·¥å…·

<span class="result-success">2. è°ƒç”¨è·¯å¾„:</span>
   å‰ç«¯ â†’ POST /execute â†’ ToolRegistry â†’ subprocess
   ä¾èµ–æœ¬åœ°å®‰è£…çš„å®‰å…¨å·¥å…· (nmap, nucleiç­‰)

<span class="result-success">3. æœ¬åœ°ç¯å¢ƒä¾èµ–:</span>
   - å¿…éœ€: nmap, whois, dig, curl
   - æ¨è: subfinder, httpx, nuclei, whatweb
   - å¯é€‰: sqlmap, hydra, gobuster, nikto

<span class="result-success">4. å·¥å…·è°ƒç”¨æ–¹å¼:</span>
   ç›´æ¥è°ƒç”¨æœ¬åœ°äºŒè¿›åˆ¶å·¥å…·
   é€šè¿‡ subprocess.run() æ‰§è¡Œå‘½ä»¤
   ä¸ä¾èµ–å¤–éƒ¨API (é™¤AIå¼•æ“å¤–)
</div>
                <div class="control-buttons">
                    <button class="btn btn-secondary" onclick="clearResults()">æ¸…ç©º</button>
                    <button class="btn btn-primary" onclick="runAllTests()">ğŸš€ å…¨éƒ¨æµ‹è¯•</button>
                </div>
            </div>
        </aside>
    </div>

    <!-- åº•éƒ¨çŠ¶æ€æ  -->
    <footer class="footer">
        <div class="footer-info">
            <span>ğŸ”§ å·¥å…·æ€»æ•°: <strong>64</strong></span>
            <span>ğŸ“Š Nucleiæ¨¡æ¿: <strong>11997</strong></span>
            <span>ğŸ¯ KEVæ¼æ´: <strong>1496</strong></span>
        </div>
        <div class="footer-info">
            <span id="lastUpdateTime">æœ€åæ›´æ–°: -</span>
        </div>
    </footer>

    <!-- å·¥å…·è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal" id="toolModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">å·¥å…·åç§°</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalBody">
                <div class="form-group">
                    <label class="form-label">ç›®æ ‡ (target)</label>
                    <input type="text" class="form-input" id="inputTarget" placeholder="ä¾‹å¦‚: 192.168.1.1 æˆ– example.com">
                </div>
                <div class="form-group" id="extraParams"></div>
                <div class="control-buttons">
                    <button class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
                    <button class="btn btn-primary" onclick="executeTool()">æ‰§è¡Œæµ‹è¯•</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===================== å·¥å…·æ•°æ®å®šä¹‰ =====================
        const TOOLS = [
            // ===== ä¿¡æ¯æ”¶é›† (20ä¸ª) =====
            { name: "nmap_scan", display: "Nmapæ‰«æ", category: "recon", dep: "nmap", desc: "ç«¯å£æ‰«æå’ŒæœåŠ¡è¯†åˆ«" },
            { name: "subdomain_enum", display: "å­åŸŸåæšä¸¾", category: "recon", dep: "subfinder", desc: "æšä¸¾ç›®æ ‡å­åŸŸå" },
            { name: "dns_enum", display: "DNSæšä¸¾", category: "recon", dep: "dig", desc: "DNSè®°å½•æŸ¥è¯¢" },
            { name: "zone_transfer", display: "åŒºåŸŸä¼ é€", category: "recon", dep: "dig", desc: "AXFRæ¼æ´æ£€æµ‹" },
            { name: "whois_lookup", display: "WhoisæŸ¥è¯¢", category: "recon", dep: "whois", desc: "åŸŸåæ³¨å†Œä¿¡æ¯" },
            { name: "theharvester", display: "TheHarvester", category: "recon", dep: "theHarvester", desc: "é‚®ç®±/å­åŸŸåæ”¶é›†" },
            { name: "whatweb", display: "WhatWeb", category: "recon", dep: "whatweb", desc: "WebæŠ€æœ¯æ ˆè¯†åˆ«" },
            { name: "wafw00f", display: "WAFæ£€æµ‹", category: "recon", dep: "wafw00f", desc: "WAFè¯†åˆ«" },
            { name: "httpx_probe", display: "Httpxæ¢æµ‹", category: "recon", dep: "httpx", desc: "HTTPæ¢æµ‹" },
            { name: "google_dork", display: "Google Dork", category: "recon", dep: null, desc: "æœç´¢è¯­æ³•ç”Ÿæˆ" },
            { name: "quick_recon", display: "å¿«é€Ÿä¾¦å¯Ÿ", category: "recon", dep: "nmap", desc: "ä¸€é”®ä¿¡æ¯æ”¶é›†" },
            { name: "intelligent_recon", display: "æ™ºèƒ½æ‰“ç‚¹", category: "recon", dep: null, desc: "AIé©±åŠ¨ä¾¦å¯Ÿ" },
            { name: "js_source_analysis", display: "JSåˆ†æ", category: "recon", dep: null, desc: "JSæºç åˆ†æ" },
            { name: "default_credential_test", display: "é»˜è®¤å£ä»¤", category: "recon", dep: null, desc: "é»˜è®¤å¯†ç æµ‹è¯•" },
            { name: "waf_bypass_test", display: "WAFç»•è¿‡", category: "recon", dep: null, desc: "WAFç»•è¿‡æµ‹è¯•" },
            { name: "complete_recon_workflow", display: "å®Œæ•´æµç¨‹", category: "recon", dep: null, desc: "10é˜¶æ®µä¾¦å¯Ÿ" },
            { name: "recon_tools_recommend", display: "å·¥å…·æ¨è", category: "recon", dep: null, desc: "å·¥å…·é“¾æ¨è" },
            { name: "identify_tech", display: "ç»„ä»¶è¯†åˆ«", category: "recon", dep: null, desc: "Webç»„ä»¶è¯†åˆ«" },
            { name: "system_check", display: "ç³»ç»Ÿæ£€æŸ¥", category: "recon", dep: null, desc: "å·¥å…·å¯ç”¨æ€§æ£€æŸ¥" },
            { name: "generate_report", display: "ç”ŸæˆæŠ¥å‘Š", category: "recon", dep: null, desc: "ç”Ÿæˆä¾¦å¯ŸæŠ¥å‘Š" },
            
            // ===== æ¼æ´æ‰«æ (10ä¸ª) =====
            { name: "vuln_scan", display: "Nucleiæ‰«æ", category: "vuln_scan", dep: "nuclei", desc: "åŸºäºæ¨¡æ¿æ¼æ´æ‰«æ" },
            { name: "nikto_scan", display: "Niktoæ‰«æ", category: "vuln_scan", dep: "nikto", desc: "WebæœåŠ¡å™¨æ¼æ´" },
            { name: "sslscan", display: "SSLæ‰«æ", category: "vuln_scan", dep: "sslscan", desc: "SSL/TLSé…ç½®æ£€æµ‹" },
            { name: "testssl", display: "TestSSL", category: "vuln_scan", dep: "testssl", desc: "å…¨é¢SSLæµ‹è¯•" },
            { name: "searchsploit", display: "Searchsploit", category: "vuln_scan", dep: "searchsploit", desc: "Exploit-DBæœç´¢" },
            { name: "cve_search", display: "CVEæœç´¢", category: "vuln_scan", dep: null, desc: "CVEä¿¡æ¯æŸ¥è¯¢" },
            { name: "nuclei_full", display: "Nucleiå…¨é‡", category: "vuln_scan", dep: "nuclei", desc: "11997æ¨¡æ¿æ‰«æ" },
            { name: "nuclei_cve", display: "Nuclei CVE", category: "vuln_scan", dep: "nuclei", desc: "ä¸“é¡¹CVEæ‰«æ" },
            { name: "deep_vuln_scan", display: "æ·±åº¦æ¼æ‰«", category: "vuln_scan", dep: null, desc: "Shiro/Log4jæ£€æµ‹" },
            { name: "nuclei_complete_scan", display: "Nucleiå®Œæ•´", category: "vuln_scan", dep: "nuclei", desc: "å®Œæ•´æ¨¡æ¿æ‰«æ" },
            
            // ===== Webæ”»å‡» (9ä¸ª) =====
            { name: "sqli_test", display: "SQLæ³¨å…¥", category: "web_attack", dep: "sqlmap", desc: "SQLMapæ£€æµ‹" },
            { name: "sqli_payload", display: "SQLi Payload", category: "web_attack", dep: null, desc: "æ³¨å…¥è½½è·ç”Ÿæˆ" },
            { name: "xss_scan", display: "XSSæ‰«æ", category: "web_attack", dep: "xsstrike", desc: "XSSæ¼æ´æ£€æµ‹" },
            { name: "dir_scan", display: "ç›®å½•æ‰«æ", category: "web_attack", dep: "gobuster", desc: "ç›®å½•/æ–‡ä»¶å‘ç°" },
            { name: "gobuster", display: "Gobuster", category: "web_attack", dep: "gobuster", desc: "æš´åŠ›æ‰«æ" },
            { name: "ffuf", display: "Ffuf", category: "web_attack", dep: "ffuf", desc: "Web Fuzzer" },
            { name: "verify_vuln", display: "æ¼æ´éªŒè¯", category: "web_attack", dep: null, desc: "æ¼æ´çœŸå®æ€§éªŒè¯" },
            { name: "get_payloads", display: "è·å–Payload", category: "web_attack", dep: null, desc: "Payloadåº“æŸ¥è¯¢" },
            { name: "payload_stats", display: "Payloadç»Ÿè®¡", category: "web_attack", dep: null, desc: "Payloadåº“ç»Ÿè®¡" },
            
            // ===== ç½‘ç»œæ”»å‡» (8ä¸ª) =====
            { name: "brute_force", display: "å¯†ç çˆ†ç ´", category: "network", dep: "hydra", desc: "ç½‘ç»œæœåŠ¡çˆ†ç ´" },
            { name: "crackmapexec", display: "CrackMapExec", category: "network", dep: "crackmapexec", desc: "åæ¸—é€å·¥å…·" },
            { name: "smb_enum", display: "SMBæšä¸¾", category: "network", dep: "enum4linux", desc: "SMBä¿¡æ¯æ”¶é›†" },
            { name: "ssh_audit", display: "SSHå®¡è®¡", category: "network", dep: "ssh-audit", desc: "SSHå®‰å…¨å®¡è®¡" },
            { name: "snmp_walk", display: "SNMP Walk", category: "network", dep: "snmpwalk", desc: "SNMPä¿¡æ¯æ”¶é›†" },
            { name: "ldap_enum", display: "LDAPæšä¸¾", category: "network", dep: "ldapsearch", desc: "LDAPä¿¡æ¯æ”¶é›†" },
            { name: "enhanced_scan", display: "å¢å¼ºæ‰«æ", category: "network", dep: null, desc: "èµ„äº§+æ¼æ´æ‰«æ" },
            { name: "smart_service_scan", display: "æ™ºèƒ½æœåŠ¡", category: "network", dep: null, desc: "ç«¯å£ç­–ç•¥åˆ†æ" },
            
            // ===== æ¼æ´åˆ©ç”¨ (3ä¸ª) =====
            { name: "msf_search", display: "MSFæœç´¢", category: "exploit", dep: "msfconsole", desc: "Metasploitæ¨¡å—æœç´¢" },
            { name: "msfvenom", display: "MsfVenom", category: "exploit", dep: "msfvenom", desc: "Payloadç”Ÿæˆ" },
            { name: "reverse_shell", display: "åå‘Shell", category: "exploit", dep: null, desc: "Shellç”Ÿæˆå™¨" },
            
            // ===== åæ¸—é€ (5ä¸ª) =====
            { name: "linpeas", display: "LinPEAS", category: "post_exploit", dep: null, desc: "Linuxææƒæšä¸¾" },
            { name: "winpeas", display: "WinPEAS", category: "post_exploit", dep: null, desc: "Windowsææƒæšä¸¾" },
            { name: "linux_exploit_suggester", display: "Linuxæ¼æ´", category: "post_exploit", dep: null, desc: "å†…æ ¸æ¼æ´å»ºè®®" },
            { name: "linenum", display: "LinEnum", category: "post_exploit", dep: null, desc: "Linuxæšä¸¾" },
            { name: "windows_enum", display: "Winæšä¸¾", category: "post_exploit", dep: null, desc: "Windowsæšä¸¾" },
            
            // ===== äº‘å®‰å…¨ (4ä¸ª) =====
            { name: "aws_enum", display: "AWSæšä¸¾", category: "cloud", dep: "aws", desc: "AWSèµ„æºæšä¸¾" },
            { name: "s3_scanner", display: "S3æ‰«æ", category: "cloud", dep: "aws", desc: "S3å­˜å‚¨æ¡¶æ‰«æ" },
            { name: "azure_enum", display: "Azureæšä¸¾", category: "cloud", dep: "az", desc: "Azureèµ„æºæšä¸¾" },
            { name: "kube_hunter", display: "K8s Hunter", category: "cloud", dep: "kube-hunter", desc: "K8så®‰å…¨æ‰«æ" },
            
            // ===== AIè¾…åŠ© (5ä¸ª) =====
            { name: "auto_recon", display: "è‡ªåŠ¨æ‰“ç‚¹", category: "ai", dep: null, desc: "AIè‡ªåŠ¨åŒ–æ¸—é€" },
            { name: "ai_attack_plan", display: "æ”»å‡»è§„åˆ’", category: "ai", dep: null, desc: "AIç”Ÿæˆæ”»å‡»è®¡åˆ’" },
            { name: "get_exploit", display: "è·å–Exploit", category: "ai", dep: null, desc: "æ¼æ´åˆ©ç”¨æ¨¡æ¿" },
            { name: "list_exploits", display: "åˆ—å‡ºExploit", category: "ai", dep: null, desc: "æ‰€æœ‰åˆ©ç”¨æ¨¡æ¿" },
            { name: "query_payload_library", display: "Payloadåº“", category: "ai", dep: null, desc: "å®Œæ•´PayloadæŸ¥è¯¢" }
        ];

        // æœ¬åœ°ä¾èµ–å·¥å…·åˆ—è¡¨
        const LOCAL_DEPENDENCIES = [
            { name: "nmap", desc: "ç«¯å£æ‰«æ", required: true },
            { name: "whois", desc: "åŸŸåæŸ¥è¯¢", required: true },
            { name: "dig", desc: "DNSæŸ¥è¯¢", required: true },
            { name: "curl", desc: "HTTPè¯·æ±‚", required: true },
            { name: "subfinder", desc: "å­åŸŸåæšä¸¾", required: false },
            { name: "httpx", desc: "HTTPæ¢æµ‹", required: false },
            { name: "nuclei", desc: "æ¼æ´æ‰«æ", required: false },
            { name: "whatweb", desc: "æŠ€æœ¯æ ˆè¯†åˆ«", required: false },
            { name: "wafw00f", desc: "WAFæ£€æµ‹", required: false },
            { name: "gobuster", desc: "ç›®å½•æ‰«æ", required: false },
            { name: "nikto", desc: "Webæ¼æ´æ‰«æ", required: false },
            { name: "sslscan", desc: "SSLæ‰«æ", required: false },
            { name: "sqlmap", desc: "SQLæ³¨å…¥", required: false },
            { name: "hydra", desc: "å¯†ç çˆ†ç ´", required: false },
            { name: "msfconsole", desc: "Metasploit", required: false }
        ];

        // ===================== çŠ¶æ€å˜é‡ =====================
        // æœåŠ¡å™¨åœ°å€é…ç½®
        let serverUrl = 'http://api.hackapt.com:5000';
        let testResults = { success: 0, failed: 0, pending: TOOLS.length };
        let currentCategory = 'all';
        let selectedTool = null;
        let depStatus = {};

        // ===================== åˆå§‹åŒ– =====================
        document.addEventListener('DOMContentLoaded', async () => {
            // å…ˆæ¸²æŸ“å·¥å…·ï¼ˆåˆå§‹çŠ¶æ€ï¼‰
            renderTools();
            bindCategoryTabs();
            
            // å¹¶è¡Œæ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€å’Œä¾èµ–
            await checkServerStatus();
            
            // æœåŠ¡å™¨åœ¨çº¿åå†æ£€æµ‹ä¾èµ–
            const dot = document.getElementById('serverStatusDot');
            if (dot.classList.contains('online')) {
                await checkDependencies();
            } else {
                // æœåŠ¡å™¨ç¦»çº¿ï¼Œæ˜¾ç¤ºè­¦å‘Š
                const list = document.getElementById('dependencyList');
                list.innerHTML = `
                    <div class="dep-item" style="background: rgba(255,71,87,0.1); border: 1px solid var(--accent-red);">
                        <span class="dep-name" style="color: var(--accent-red);">âš ï¸ æœåŠ¡å™¨ç¦»çº¿ï¼Œæ— æ³•æ£€æµ‹ä¾èµ–</span>
                    </div>
                `;
            }
        });

        // ===================== æ¸²æŸ“å·¥å…·çŸ©é˜µ =====================
        function renderTools(category = 'all') {
            const grid = document.getElementById('toolsGrid');
            grid.innerHTML = '';
                    
            const filteredTools = category === 'all' 
                ? TOOLS 
                : TOOLS.filter(t => t.category === category);
                    
            filteredTools.forEach(tool => {
                const btn = document.createElement('div');
                btn.className = 'tool-btn';
                btn.dataset.tool = tool.name;
                        
                // åˆ¤æ–­å·¥å…·å¯ç”¨æ€§ï¼šæ— ä¾èµ–ä¸ºå¯ç”¨ï¼Œæœ‰ä¾èµ–åˆ™æ£€æŸ¥depStatus
                let statusClass = '';
                let statusTitle = '';
                        
                if (!tool.dep) {
                    // æ— å¤–éƒ¨ä¾èµ–ï¼Œå·¥å…·å¯ç”¨ï¼ˆPythonå†…ç½®ï¼‰
                    statusClass = 'available';
                    statusTitle = 'æ— å¤–éƒ¨ä¾èµ–ï¼Œå¯ç›´æ¥ä½¿ç”¨';
                } else if (depStatus[tool.dep] === true) {
                    // ä¾èµ–å·²å®‰è£…
                    statusClass = 'available';
                    statusTitle = `ä¾èµ– ${tool.dep} å·²å®‰è£…`;
                } else if (depStatus[tool.dep] === false) {
                    // ä¾èµ–æœªå®‰è£…
                    statusClass = 'unavailable';
                    statusTitle = `ä¾èµ– ${tool.dep} æœªå®‰è£…`;
                } else {
                    // çŠ¶æ€æœªçŸ¥
                    statusClass = '';
                    statusTitle = `ä¾èµ– ${tool.dep} çŠ¶æ€æœªçŸ¥`;
                }
                        
                btn.innerHTML = `
                    <div class="tool-status ${statusClass}" id="status-${tool.name}" title="${statusTitle}"></div>
                    <div class="tool-name">${tool.display}</div>
                    <div class="tool-category">${getCategoryName(tool.category)} ${tool.dep ? 'â€¢ ' + tool.dep : ''}</div>
                `;
                btn.onclick = () => openToolModal(tool);
                grid.appendChild(btn);
            });
        }

        function getCategoryName(cat) {
            const names = {
                recon: 'ä¿¡æ¯æ”¶é›†',
                vuln_scan: 'æ¼æ´æ‰«æ',
                web_attack: 'Webæ”»å‡»',
                network: 'ç½‘ç»œæ”»å‡»',
                exploit: 'æ¼æ´åˆ©ç”¨',
                post_exploit: 'åæ¸—é€',
                cloud: 'äº‘å®‰å…¨',
                ai: 'AIè¾…åŠ©'
            };
            return names[cat] || cat;
        }

        // ===================== åˆ†ç±»æ ‡ç­¾ç»‘å®š =====================
        function bindCategoryTabs() {
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.onclick = () => {
                    document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    currentCategory = tab.dataset.category;
                    renderTools(currentCategory);
                };
            });
        }

        // ===================== æœåŠ¡å™¨çŠ¶æ€æ£€æŸ¥ =====================
        async function checkServerStatus() {
            const dot = document.getElementById('serverStatusDot');
            const text = document.getElementById('serverStatusText');
            
            try {
                const resp = await fetch(`${serverUrl}/health`, { 
                    method: 'GET',
                    mode: 'cors'
                });
                if (resp.ok) {
                    dot.className = 'status-dot online';
                    text.textContent = 'æœåŠ¡åœ¨çº¿';
                } else {
                    throw new Error('Server error');
                }
            } catch (e) {
                dot.className = 'status-dot offline';
                text.textContent = 'æœåŠ¡ç¦»çº¿';
            }
        }

        // ===================== ä¾èµ–æ£€æŸ¥ =====================
        async function checkDependencies() {
            const list = document.getElementById('dependencyList');
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            list.innerHTML = '<div class="dep-item"><span class="dep-name">æ­£åœ¨æ£€æµ‹...</span><span class="dep-status missing">â³</span></div>';
            
            // é‡ç½®ä¾èµ–çŠ¶æ€
            depStatus = {};
            
            try {
                const resp = await fetch(`${serverUrl}/logs/init`, {
                    method: 'GET',
                    mode: 'cors',
                    headers: { 'Accept': 'application/json' }
                });
                
                if (!resp.ok) {
                    throw new Error(`æœåŠ¡å™¨è¿”å› ${resp.status}`);
                }
                
                const data = await resp.json();
                
                if (data.success && Array.isArray(data.statuses)) {
                    // ä»åç«¯è¿”å›çš„statusesä¸­æå–å”¯ä¸€çš„ä¾èµ–é¡¹
                    const depMap = new Map(); // key: dependencyåç§°, value: {ok: boolean, tools: []}
                    
                    data.statuses.forEach(s => {
                        const depName = s.dependency || null;
                        if (depName) {
                            if (!depMap.has(depName)) {
                                depMap.set(depName, {
                                    ok: s.dependency_ok !== false, // é»˜è®¤trueï¼Œé™¤éæ˜ç¡®false
                                    tools: []
                                });
                            }
                            const dep = depMap.get(depName);
                            dep.tools.push(s.tool);
                            // åªè¦æœ‰ä¸€ä¸ªæ£€æµ‹ä¸ºfalseï¼Œå°±æ ‡è®°ä¸ºfalse
                            if (s.dependency_ok === false) {
                                dep.ok = false;
                            }
                        }
                        
                        // æ›´æ–°å…¨å±€ä¾èµ–çŠ¶æ€ç”¨äºå·¥å…·æŒ‰é’®æ˜¾ç¤º
                        if (depName) {
                            depStatus[depName] = depMap.get(depName).ok;
                        }
                    });
                    
                    // æŒ‰çŠ¶æ€æ’åºï¼šæœªå®‰è£…çš„åœ¨å‰ï¼Œå·²å®‰è£…çš„åœ¨å
                    const sortedDeps = Array.from(depMap.entries()).sort((a, b) => {
                        if (a[1].ok === b[1].ok) return a[0].localeCompare(b[0]);
                        return a[1].ok ? 1 : -1;
                    });
                    
                    // ç»Ÿè®¡
                    const installed = sortedDeps.filter(d => d[1].ok).length;
                    const missing = sortedDeps.filter(d => !d[1].ok).length;
                    
                    // æ¸²æŸ“ä¾èµ–åˆ—è¡¨
                    list.innerHTML = `
                        <div class="dep-item" style="background: transparent; padding: 5px 0; border-bottom: 1px solid var(--border-color); margin-bottom: 8px;">
                            <span class="dep-name" style="font-size: 0.75rem; color: var(--text-secondary);">å…± ${sortedDeps.length} ä¸ªä¾èµ–</span>
                            <span style="font-size: 0.75rem;">
                                <span style="color: var(--accent-green)">âœ“${installed}</span> / 
                                <span style="color: var(--accent-red)">âœ—${missing}</span>
                            </span>
                        </div>
                        ${sortedDeps.map(([name, info]) => `
                            <div class="dep-item" title="ä½¿ç”¨æ­¤ä¾èµ–çš„å·¥å…·: ${info.tools.join(', ')}">
                                <span class="dep-name">${name}</span>
                                <span class="dep-status ${info.ok ? 'installed' : 'missing'}">
                                    ${info.ok ? 'å·²å®‰è£…' : 'æœªå®‰è£…'}
                                </span>
                            </div>
                        `).join('')}
                    `;
                    
                    // æ›´æ–°ç»“æœåŒºåŸŸæ˜¾ç¤º
                    appendResult(`\n[ä¾èµ–æ£€æµ‹] å®Œæˆ - å·²å®‰è£…: ${installed}, æœªå®‰è£…: ${missing}`, installed === sortedDeps.length ? 'success' : 'info');
                    
                } else {
                    throw new Error(data.error || 'è¿”å›æ•°æ®æ ¼å¼é”™è¯¯');
                }
                
            } catch (e) {
                console.error('ä¾èµ–æ£€æµ‹å¤±è´¥:', e);
                
                // æœåŠ¡å™¨ç¦»çº¿æˆ–è¯·æ±‚å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°é™æ€åˆ—è¡¨
                list.innerHTML = `
                    <div class="dep-item" style="background: rgba(255,71,87,0.1); border: 1px solid var(--accent-red);">
                        <span class="dep-name" style="color: var(--accent-red);">âš ï¸ æ£€æµ‹å¤±è´¥: ${e.message}</span>
                    </div>
                    ${LOCAL_DEPENDENCIES.map(dep => `
                        <div class="dep-item">
                            <span class="dep-name">${dep.name} ${dep.required ? '(å¿…éœ€)' : ''}</span>
                            <span class="dep-status missing">æœªçŸ¥</span>
                        </div>
                    `).join('')}
                `;
                
                // æ ‡è®°æ‰€æœ‰ä¾èµ–ä¸ºæœªçŸ¥çŠ¶æ€
                LOCAL_DEPENDENCIES.forEach(dep => {
                    depStatus[dep.name] = undefined;
                });
                
                appendResult(`\n[ä¾èµ–æ£€æµ‹] å¤±è´¥ - ${e.message}`, 'error');
            }
            
            // é‡æ–°æ¸²æŸ“å·¥å…·çŸ©é˜µä»¥æ›´æ–°å¯ç”¨çŠ¶æ€
            renderTools(currentCategory);
        }

        // ===================== å·¥å…·æ¨¡æ€æ¡† =====================
        function openToolModal(tool) {
            selectedTool = tool;
            document.getElementById('modalTitle').textContent = `ğŸ”§ ${tool.display}`;
            document.getElementById('inputTarget').value = '';
            document.getElementById('extraParams').innerHTML = `
                <p style="color: var(--text-secondary); font-size: 0.85rem; margin-bottom: 10px;">
                    <strong>å·¥å…·æè¿°:</strong> ${tool.desc}<br>
                    <strong>ä¾èµ–å·¥å…·:</strong> ${tool.dep || 'æ—  (Pythonå†…ç½®)'}<br>
                    <strong>å·¥å…·ID:</strong> ${tool.name}
                </p>
            `;
            document.getElementById('toolModal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('toolModal').classList.remove('show');
            selectedTool = null;
        }

        // ===================== æ‰§è¡Œå·¥å…·æµ‹è¯• =====================
        async function executeTool() {
            if (!selectedTool) return;
            
            const target = document.getElementById('inputTarget').value.trim();
            if (!target && selectedTool.name !== 'system_check' && selectedTool.name !== 'payload_stats') {
                appendResult(`[é”™è¯¯] è¯·è¾“å…¥ç›®æ ‡`, 'error');
                return;
            }

            closeModal();
            
            const toolBtn = document.querySelector(`[data-tool="${selectedTool.name}"]`);
            const statusDot = document.getElementById(`status-${selectedTool.name}`);
            
            // æ›´æ–°æµç¨‹å›¾çŠ¶æ€
            updateFlowStep(1);
            
            toolBtn.classList.add('running');
            statusDot.classList.add('running');
            
            appendResult(`\n[${new Date().toLocaleTimeString()}] å¼€å§‹æµ‹è¯•: ${selectedTool.display}`, 'info');
            appendResult(`ç›®æ ‡: ${target || 'N/A'}`, 'info');

            try {
                updateFlowStep(2);
                
                const params = { target };
                if (selectedTool.name === 'nmap_scan') {
                    params.scan_type = 'quick';
                }

                updateFlowStep(3);
                updateFlowStep(4);
                
                const resp = await fetch(`${serverUrl}/execute`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        tool: selectedTool.name,
                        params: params
                    })
                });

                updateFlowStep(5);
                
                const result = await resp.json();
                
                updateFlowStep(6);

                if (result.success) {
                    toolBtn.classList.remove('running');
                    toolBtn.classList.add('success');
                    statusDot.classList.remove('running');
                    statusDot.classList.add('available');
                    
                    testResults.success++;
                    testResults.pending--;
                    
                    appendResult(`[æˆåŠŸ] ${selectedTool.display} æ‰§è¡Œå®Œæˆ (${result.duration?.toFixed(2) || 0}s)`, 'success');
                    if (result.result?.stdout) {
                        appendResult(result.result.stdout.substring(0, 500), 'info');
                    }
                } else {
                    throw new Error(result.error || 'æ‰§è¡Œå¤±è´¥');
                }
            } catch (e) {
                toolBtn.classList.remove('running');
                toolBtn.classList.add('failed');
                statusDot.classList.remove('running');
                statusDot.classList.add('unavailable');
                
                testResults.failed++;
                testResults.pending--;
                
                appendResult(`[å¤±è´¥] ${selectedTool.display}: ${e.message}`, 'error');
            }

            updateStats();
            clearFlowSteps();
        }

        // ===================== è¾…åŠ©å‡½æ•° =====================
        function appendResult(text, type = 'info') {
            const area = document.getElementById('resultArea');
            const span = document.createElement('span');
            span.className = `result-${type}`;
            span.textContent = text + '\n';
            area.appendChild(span);
            area.scrollTop = area.scrollHeight;
        }

        function clearResults() {
            document.getElementById('resultArea').innerHTML = '<span class="result-info">ç»“æœå·²æ¸…ç©ºï¼Œç­‰å¾…æ–°çš„æµ‹è¯•...</span>\n';
        }

        function updateStats() {
            document.getElementById('statSuccess').textContent = `æˆåŠŸ: ${testResults.success}`;
            document.getElementById('statFailed').textContent = `å¤±è´¥: ${testResults.failed}`;
            document.getElementById('statPending').textContent = `å¾…æµ‹: ${testResults.pending}`;
            document.getElementById('lastUpdateTime').textContent = `æœ€åæ›´æ–°: ${new Date().toLocaleTimeString()}`;
        }

        function updateFlowStep(stepNum) {
            document.querySelectorAll('.flow-step').forEach((step, i) => {
                step.classList.toggle('active', i + 1 <= stepNum);
            });
        }

        function clearFlowSteps() {
            setTimeout(() => {
                document.querySelectorAll('.flow-step').forEach(step => {
                    step.classList.remove('active');
                });
            }, 2000);
        }

        // ===================== å…¨éƒ¨æµ‹è¯• =====================
        async function runAllTests() {
            const quickTests = ['system_check', 'payload_stats', 'list_exploits', 'google_dork'];
            
            appendResult('\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
            appendResult('å¼€å§‹æ‰¹é‡æµ‹è¯• (ä»…æµ‹è¯•æ— éœ€ç›®æ ‡çš„å·¥å…·)', 'info');
            appendResult('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n', 'info');

            for (const toolName of quickTests) {
                const tool = TOOLS.find(t => t.name === toolName);
                if (!tool) continue;
                
                selectedTool = tool;
                document.getElementById('inputTarget').value = toolName === 'google_dork' ? 'example.com' : '';
                
                const toolBtn = document.querySelector(`[data-tool="${toolName}"]`);
                toolBtn?.classList.add('running');
                
                try {
                    const resp = await fetch(`${serverUrl}/execute`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            tool: toolName,
                            params: toolName === 'google_dork' ? { domain: 'example.com' } : {}
                        })
                    });
                    
                    const result = await resp.json();
                    
                    if (result.success) {
                        toolBtn?.classList.remove('running');
                        toolBtn?.classList.add('success');
                        appendResult(`âœ“ ${tool.display}: æˆåŠŸ`, 'success');
                        testResults.success++;
                    } else {
                        throw new Error(result.error);
                    }
                } catch (e) {
                    toolBtn?.classList.remove('running');
                    toolBtn?.classList.add('failed');
                    appendResult(`âœ— ${tool.display}: ${e.message}`, 'error');
                    testResults.failed++;
                }
                
                testResults.pending--;
                updateStats();
                
                // é—´éš”æ‰§è¡Œ
                await new Promise(r => setTimeout(r, 500));
            }
            
            appendResult('\næ‰¹é‡æµ‹è¯•å®Œæˆ', 'info');
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.getElementById('toolModal').onclick = function(e) {
            if (e.target === this) closeModal();
        };
    </script>
</body>
</html>
